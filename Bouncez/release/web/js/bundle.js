var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function o(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(o.prototype=a.prototype,new o)}}();!function(){function e(t,a,o){function i(r,s){if(!a[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=a[r]={exports:{}};t[r][0].call(u.exports,function(e){return i(t[r][1][e]||e)},u,u.exports,e,t,a,o)}return a[r].exports}for(var n="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}return e}()({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("./script/runtime/ReviveView"),i=e("./script/runtime/GameScene"),n=e("./script/runtime/HomeView"),r=e("./script/component/Reward"),s=e("./script/runtime/OverView"),l=function(){function e(){}return e.init=function(){var e=Laya.ClassUtils.regClass;e("script/runtime/ReviveView.ts",o.default),e("script/runtime/GameScene.ts",i.default),e("script/runtime/HomeView.ts",n.default),e("script/component/Reward.ts",r.default),e("script/runtime/OverView.ts",s.default)},e.width=720,e.height=1280,e.scaleMode="showall",e.screenMode="vertical",e.alignV="middle",e.alignH="center",e.startScene="home/HomeView.scene",e.sceneRoot="",e.debug=!1,e.stat=!0,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();a.default=l,l.init()},{"./script/component/Reward":9,"./script/runtime/GameScene":10,"./script/runtime/HomeView":11,"./script/runtime/OverView":12,"./script/runtime/ReviveView":13}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("./GameConfig");new(function(){function e(){window.Laya3D?Laya3D.init(o.default.width,o.default.height):Laya.init(o.default.width,o.default.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=o.default.scaleMode,Laya.stage.screenMode=o.default.screenMode,Laya.URL.exportSceneToJson=o.default.exportSceneToJson,(o.default.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),o.default.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),o.default.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.stage.height=Math.round(o.default.width*Laya.Browser.height/Laya.Browser.width);var e=new Laya.BitmapFont;e.loadFont("res/font/nums.fnt",null),Laya.Text.registerBitmapFont("nums",e)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){o.default.startScene&&Laya.Scene.open(o.default.startScene)},e}())},{"./GameConfig":1}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.VERSION="1.0.5",a.URL_HomeView="home/HomeView.scene",a.URL_GameScene="game/GameScene.scene",a.URL_OverView="over/OverView.scene",a.URL_ReviveView="dialog/ReviveView.scene",a.PlayerMeshTypeNum=6;!function(e){e[e.CAT=0]="CAT",e[e.BALL01=1]="BALL01",e[e.BALL02=2]="BALL02",e[e.BALL03=3]="BALL03",e[e.BALL04=4]="BALL04",e[e.BALL05=5]="BALL05"}(a.PlayerMeshType||(a.PlayerMeshType={})),a.URL_PlayerModel=["res/model/game/cat.lm","ball","ball","ball","ball","ball"],a.URL_PlayerMaterial=["res/texture/game/cat.png","res/texture/game/ball01.png","res/texture/game/ball02.png","res/texture/game/ball03.png","res/texture/game/ball04.png","res/texture/game/ball05.png"],a.URL_PlayerIcon=["res/texture/game/cat.jpg","res/texture/game/ball01.png","res/texture/game/ball02.png","res/texture/game/ball03.png","res/texture/game/ball04.png","res/texture/game/ball05.png"],a.URL_Trail="res/model/game/trail.lh",a.TrailColor=[new Laya.Color(1,1,1,1),new Laya.Color(.5,0,0,1),new Laya.Color(.5,0,0,1),new Laya.Color(.5,.5,0,1),new Laya.Color(1,.4,0,1),new Laya.Color(.5,0,0,1)],a.URL_PlayerTexture1="res/texture/game/ball05.png",a.URL_PlayerTexture2="res/texture/game/ball03.png",a.URL_BoardMesh="res/model/game/board.lm",a.URL_BoardMaterial="res/texture/game/board.png",a.URL_HelixMesh="res/model/game/helix.lm",a.URL_WaveTexture="res/texture/game/wave.png",a.URL_DiamondMesh="res/model/game/diamond.lm",a.URL_DiamondPieceMesh="res/model/game/diamond_piece.lm",a.URL_Particle=["res/model/game/particle_blue.lh","res/model/game/particle_red.lh"],a.URL_ParticleSprint=["res/model/game/particleSprint_blue.lh","res/model/game/particleSprint_red.lh"],a.URL_Background=["res/texture/game/bg01/bg.png","res/texture/game/bg02/bg.png"],a.URL_BG_Bottom=["res/texture/game/bg01/bg_bottom.png","res/texture/game/bg02/bg_bottom.png"],a.URL_Front_Top=["res/texture/game/bg01/front_top.png","res/texture/game/bg02/front_top.png"],a.URL_Front_bottom=["res/texture/game/bg01/front_bottom.png","res/texture/game/bg02/front_bottom.png"],a.URL_BGM="res/sounds/TheFatRat.mp3",a.RewardPos={OverShare:"OverShare",Revive:"revive"},a.BannerPos={HomeView:"HomeView",OverView:"DieScene",ReviveDialog:"Revive"},a.ReviveCountdown=5;!function(e){e[e.READY=1]="READY",e[e.PLAYING=2]="PLAYING",e[e.PAUSE=3]="PAUSE",e[e.OVER=4]="OVER"}(a.GameState||(a.GameState={}));!function(e){e[e.JUMPUP=1]="JUMPUP",e[e.FALLDOWN=2]="FALLDOWN",e[e.SPRINT=3]="SPRINT"}(a.PlayerJumpState||(a.PlayerJumpState={})),a.PlayerRadius=.45,a.PlayerJumpFrames=20,a.PlayerJumpStep=[.8,.6,.5,.4,.3,.2,.15,.1,.05,.03],a.PlayerJumpFramesSpring=27,a.PlayerJumpStepSpring=[1.2,.8,.6,.4,.3,.2,.15,.1,.05],a.PlayerJumpFramesSprint=240,a.PlayerJumpStepSprint=a.PlayerJumpStep[0],a.CameraOffsetYSprint=15,a.PlayerSprintStepY=10,a.PlayerMaxDownFrames=40;!function(e){e[e.NORMAL=0]="NORMAL",e[e.SPRING=1]="SPRING",e[e.DROP=2]="DROP",e[e.GIANT=3]="GIANT",e[e.SUPERMAN=4]="SUPERMAN",e[e.DWRAF=5]="DWRAF"}(a.BoardType||(a.BoardType={})),a.BoardRadius=1.5,a.BoardHeight=.25,a.BoardGap=4.3,a.BoardGapSpring=9,a.BoardGapSprint=a.PlayerJumpStepSprint*a.PlayerJumpFramesSprint,a.SceneMaxOffsetX=3.5,a.BoardHeightScale=1,a.BoardHeightScaleDROP=.5,a.BoardRadiusScale=1,a.BoardRadiusScaleGiant=2.8,a.BoardRadiusScaleDWRAF=.6,a.BoardRadiusCenter=.35,a.BoardColor=[new Laya.Vector4(1,.78431373,.81960784,1),new Laya.Vector4(.7,.85,1,1)],a.BoardInitPos=new Laya.Vector3(0,8,0),a.BoardNum=6,a.BoardNewIndex=2,a.BoardBumpFrames=10,a.BoardBumpStep=[-.15,-.1,-.07,-.02,-.003,.003,.02,.07,.1,.15],a.WaveRadius=1.3,a.WaveHeight=.01,a.WaveOffsetY=.13,a.BoardWaveFrames=16,a.BoardWaveInnerStartFrames=8,a.BoardWaveStep=.15,a.BoardWaveInnerStep=.12,a.SpringRadius=.7,a.SpringHeight=.2,a.BoardSpringFrames=10,a.SpringHelixStep=.25,a.SpringHelixStepSprint=.8,a.SpringTopStep=.25,a.SpringTopStepSprint=.5,a.BoardDropFrames=40,a.BoardDropStep=.5,a.BoardMovingStep=.03,a.ScoreBoardCenter=2,a.ScoreBoardNotCenter=1,a.DiamondRadius=.3,a.DiamondNum=10,a.DiamondPieceNum=10,a.DiamondSprintStepY=5*a.PlayerJumpStepSprint,a.DiamondStartFrame=6,a.DiamondScore=1,a.DiamondSprintScoreArea=1,a.DiamondScoreArea=.6,a.DiamondColor=[new Laya.Vector4(.133333,.64313725,1,1),new Laya.Vector4(1,0,.18823529,.6)],a.DiamondRotateStepY=1.5,a.CameraInitPos=new Laya.Vector3(0,15,16),a.CameraInitRot=new Laya.Vector3(-15,0,0),a.CameraOffsetY=10,a.CameraMoveXFrames=20,a.CameraMoveYFrames=15,a.CameraMoveYFramesSpring=23,a.CameraMoveXMinErr=.02,a.CameraMoveYMinErr=.02,a.SkyColor=new Laya.Vector4(1,.65,.5,1),a.DirectionLightPos=new Laya.Vector3(0,3,0),a.DirectionLightRot=new Laya.Vector3(-60,0,0),a.DirectionLightColor=new Laya.Vector3(1,1,1),a.CoeffRotPlayer=-3,a.CoeffPosPlayer=8/360,a.CoeffPosCam=2.5/360},{}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default={gameData:{musicEnabled:!0,soundEnabled:!0,updateTimestamp:0,videoCount:0,lastVideoTimestamp:0,shareCount:0,lastShareTimestamp:0,diamond:0,skinUnlock:[{index:0,cost:"diamond",value:10,state:!0},{index:1,cost:"diamond",value:10,state:!1},{index:2,cost:"score",value:50,state:!1},{index:3,cost:"diamond",value:20,state:!1},{index:4,cost:"diamond",value:30,state:!1},{index:5,cost:"video",value:0,state:!1}]},config:{skin_block:!1,share_first:!1,allow_share:!0,allow_video:!0,share_number:5,video_number:6,share_time:30,banner_time:180,share_delay:4,online:!0,debug:!1,allow_pay:!1,allow_revive:!0,banner_delay:1,banner_delay_ratio:.8,banner_delay_ratio1:.8,share_fail:"'操作失败，请换个群'",distance_iphonex:50,banner_click_time:2,games:{},shares:{},videos:{},banners:{}},user:{},audio:{volume:.5}}},{}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("../Const"),i=e("../runtime/GameScene"),n=e("../util/Util"),r=function(e){function t(){var t=e.call(this)||this;return t.isActive=!1,t.diamondList=[],t.isMoving=!1,t.isMovingRight=!0,t.hasDiamond=!1,t.type=o.BoardType.NORMAL,t.currBumpFrame=o.BoardBumpFrames,t.currDropFrame=o.BoardDropFrames,t}return __extends(t,e),t.prototype.onAwake=function(){this.board=this.owner,this.initCenter(),this.initWave(),this.initSpring(),this.initDiamond()},t.prototype.initCenter=function(){this.center=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCylinder(o.BoardRadiusCenter,.005)),this.board.parent.addChild(this.center),this.center.active=!1;var e=new Laya.BlinnPhongMaterial;e.specularColor=new Laya.Vector4(0,0,0,0),e.albedoColor=new Laya.Vector4(1,1,1,.8),e.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,this.center.meshRenderer.material=e},t.prototype.initWave=function(){this.wave=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCylinder(o.WaveRadius,o.WaveHeight)),this.board.parent.addChild(this.wave),this.wave.active=!1,this.waveInner=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCylinder(o.WaveRadius,o.WaveHeight)),this.board.parent.addChild(this.waveInner),this.waveInner.active=!1,this.currWaveFrame=o.BoardWaveFrames,Laya.loader.create(o.URL_WaveTexture,Laya.Handler.create(this,this.setWaveMat))},t.prototype.setWaveMat=function(e){var t=new Laya.BlinnPhongMaterial;t.albedoTexture=e,t.albedoColor=new Laya.Vector4(1,1,1,1),t.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,this.wave.meshRenderer.material=t,this.waveInner.meshRenderer.material=t.clone()},t.prototype.initSpring=function(){var e=this;Laya.Mesh.load(o.URL_HelixMesh,Laya.Handler.create(this,function(t){e.springHelix=new Laya.MeshSprite3D(t);var a=new Laya.BlinnPhongMaterial;a.albedoColor=new Laya.Vector4(1,1,1,.3),a.specularColor=new Laya.Vector4(0,0,0,0),a.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,e.springHelix.meshRenderer.material=a,e.springHelix.transform.localRotationEuler=new Laya.Vector3(-90,0,0),e.springHelix.transform.localScale=new Laya.Vector3(1.5,1.5,1),e.setSpringPos(),e.board.parent.addChild(e.springHelix),e.springHelix.active=!1,e.currSpringFrame=2*o.BoardSpringFrames})),this.springTop=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCylinder(o.SpringRadius,o.SpringHeight)),this.board.parent.addChild(this.springTop),this.springTop.active=!1,this.springTop.transform.localPosition=this.getPos(),this.springTop.transform.localPositionY+=(o.BoardHeight+o.SpringHeight)/2;var t=new Laya.BlinnPhongMaterial,a=i.default.instance.skyCount%i.default.instance.skyNum;t.albedoColor=o.BoardColor[a],t.specularColor=new Laya.Vector4(0,0,0,0),this.springTop.meshRenderer.material=t},t.prototype.initDiamond=function(){var e=this;Laya.Mesh.load(o.URL_DiamondMesh,Laya.Handler.create(this,function(t){var a=new Laya.MeshSprite3D(t);a.transform.localScale=new Laya.Vector3(1,1,2);var n=new Laya.BlinnPhongMaterial,r=i.default.instance.skyCount%i.default.instance.skyNum;n.albedoColor=o.DiamondColor[r],n.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,a.meshRenderer.material=n;for(var s=0;s<5;s++)e.diamondList[s]=a.clone(),e.board.parent.addChild(e.diamondList[s]),e.diamondList[s].active=!1}))},t.prototype.reset=function(e,t,a){this.isActive=!1,this.currWaveFrame=o.BoardWaveFrames,this.currSpringFrame=2*o.BoardSpringFrames,this.currBumpFrame=o.BoardBumpFrames,this.currDropFrame=o.BoardDropFrames,this.type=e,this.board.transform.localPosition=t.clone(),this.isMoving=!1,this.type!==o.BoardType.NORMAL&&this.type!==o.BoardType.DROP&&this.type!==o.BoardType.SPRING||(this.isMoving=this.setMove(a)),this.type===o.BoardType.GIANT?(this.board.transform.localScaleX=o.BoardRadiusScaleGiant,this.board.transform.localScaleZ=o.BoardRadiusScaleGiant):this.type===o.BoardType.DWRAF?(this.board.transform.localScaleX=o.BoardRadiusScaleDWRAF,this.board.transform.localScaleZ=o.BoardRadiusScaleDWRAF):(this.board.transform.localScaleX=o.BoardRadiusScale,this.board.transform.localScaleZ=o.BoardRadiusScale),this.type===o.BoardType.DROP?(this.board.transform.localScaleY=o.BoardHeightScaleDROP,this.posBeforeDrop=this.getPos()):this.board.transform.localScaleY=o.BoardHeightScale,this.type!=o.BoardType.GIANT?(this.center.active=!0,this.setCenterPos()):this.center.active=!1;var n=i.default.instance.skyCount%i.default.instance.skyNum;if(this.board.meshRenderer.material.albedoColor=o.BoardColor[n],this.springTop.active=!1,this.type===o.BoardType.SPRING){this.springHelix.active=!0,this.springTop.active=!0,this.setSpringPos();var r=i.default.instance.skyCount%i.default.instance.skyNum;this.springTop.meshRenderer.material.albedoColor=o.BoardColor[r]}if(this.type===o.BoardType.SUPERMAN&&(this.springHelix.active=!0,this.springTop.active=!0,this.setSpringPos(),this.board.meshRenderer.material.albedoColor=new Laya.Vector4(.536453,.4103774,1,1),this.springTop.meshRenderer.material.albedoColor=new Laya.Vector4(.536453,.4103774,1,1)),this.hasDiamond=!1,this.diamondList[0]){for(l=0;l<5;l++){this.diamondList[l].active=!1;var s=i.default.instance.skyCount%i.default.instance.skyNum;this.diamondList[l].meshRenderer.material.albedoColor=o.DiamondColor[s]}if(this.type===o.BoardType.GIANT)for(var l=0;l<5;l++)this.diamondList[l].active=!0,this.hasDiamond=!0;else if(this.type===o.BoardType.NORMAL||this.type===o.BoardType.DROP){Math.random()>.7&&(this.diamondList[2].active=!0,this.hasDiamond=!0)}this.hasDiamond&&this.setDiamondPos()}},t.prototype.onUpdate=function(){this.effectBump(),this.effectWave(),this.type!==o.BoardType.SPRING&&this.type!==o.BoardType.SUPERMAN||this.effectSpring(),this.effectDrop(),this.effectMove(),this.hasDiamond&&this.effectDiamondRotate()},t.prototype.setBump=function(){this.currBumpFrame=0},t.prototype.effectBump=function(){this.currBumpFrame<o.BoardBumpFrames&&(this.board.transform.localPositionY+=o.BoardBumpStep[this.currBumpFrame],this.setCenterPos(),this.currBumpFrame++)},t.prototype.setCenterPos=function(){this.center.transform.localPosition=this.getPos(),this.center.transform.localPositionY+=o.BoardHeight/2},t.prototype.setDiamondPos=function(){for(var e=0;e<5;e++)this.diamondList[e].active&&(this.diamondList[e].transform.localPosition=this.getPos(),this.diamondList[e].transform.localPositionX+=1.4*(e-2),this.diamondList[e].transform.localPositionY+=o.BoardHeight)},t.prototype.setWave=function(){this.type!=o.BoardType.GIANT&&(this.currWaveFrame=0,this.wave.transform.localPosition=this.getPos(),this.wave.transform.localPositionY+=o.WaveOffsetY,this.wave.transform.localScale=new Laya.Vector3(1,1,1),this.wave.active=!0,this.wave.meshRenderer.material.albedoColorA=.5,Laya.Tween.to(this.wave.meshRenderer.material,{albedoColorR:1,albedoColorG:1,albedoColorB:1,albedoColorA:0},o.BoardWaveFrames/60*1e3,Laya.Ease.linearInOut),this.waveInner.transform.localPosition=this.getPos(),this.waveInner.transform.localPositionY+=o.WaveOffsetY,this.waveInner.transform.localScale=new Laya.Vector3(1,1,1))},t.prototype.effectWave=function(){this.currWaveFrame<o.BoardWaveFrames?(this.currWaveFrame>=o.BoardWaveInnerStartFrames&&(this.waveInner.active||(this.waveInner.meshRenderer.material.albedoColorA=.3,Laya.Tween.to(this.waveInner.meshRenderer.material,{albedoColorR:1,albedoColorG:1,albedoColorB:1,albedoColorA:0},(o.BoardWaveFrames-o.BoardWaveInnerStartFrames)/60*1e3,Laya.Ease.linearInOut)),this.waveInner.active=!0,this.waveInner.transform.localScaleX+=o.BoardWaveInnerStep,this.waveInner.transform.localScaleZ+=o.BoardWaveInnerStep),this.wave.transform.localScaleX+=o.BoardWaveStep,this.wave.transform.localScaleZ+=o.BoardWaveStep,this.currWaveFrame++):(this.wave.active=!1,this.waveInner.active=!1)},t.prototype.setSpring=function(){this.currSpringFrame=0,this.setSpringPos(),this.springHelix.transform.localScale=new Laya.Vector3(1.5,1.5,1),this.springHelix.active=!0,this.springTop.active=!0},t.prototype.setSpringPos=function(){this.springHelix.transform.localPosition=this.getPos(),this.springHelix.transform.localPositionY+=o.BoardHeight/2,this.springTop.transform.localPosition=this.getPos(),this.springTop.transform.localPositionY+=(o.BoardHeight+o.SpringHeight)/2},t.prototype.effectSpring=function(){var e=this.type===o.BoardType.SUPERMAN?o.SpringHelixStepSprint:o.SpringHelixStep,t=this.type===o.BoardType.SUPERMAN?o.SpringTopStepSprint:o.SpringTopStep;this.currSpringFrame<o.BoardSpringFrames?(this.springHelix.transform.localScaleZ+=e,this.springTop.transform.localPositionY+=t,this.currSpringFrame++):this.currSpringFrame>=o.BoardSpringFrames&&this.currSpringFrame<2*o.BoardSpringFrames?(this.springHelix.transform.localScaleZ-=e,this.springTop.transform.localPositionY-=t,this.currSpringFrame++):this.springHelix.active=!1},t.prototype.setDrop=function(){this.currDropFrame=0,this.posBeforeDrop=this.getPos()},t.prototype.effectDrop=function(){if(this.currDropFrame<o.BoardDropFrames){for(var e=0;e<5;e++)this.diamondList[e].active=!1;this.springTop.active&&(this.springHelix.active=!1,this.springTop.transform.localPositionY-=o.BoardDropStep),this.board.transform.localPositionY-=o.BoardDropStep,this.setCenterPos(),this.currDropFrame++}},t.prototype.setMove=function(e){var t=n.getDiffCoeff(e,1,10);return Math.random()*t>5},t.prototype.effectMove=function(){if(this.isMoving){var e=this.board.transform.localPositionX;this.isMovingRight&&e<=o.SceneMaxOffsetX?this.board.transform.localPositionX+=o.BoardMovingStep:this.isMovingRight&&e>o.SceneMaxOffsetX?this.isMovingRight=!1:!this.isMovingRight&&e>=-o.SceneMaxOffsetX?this.board.transform.localPositionX-=o.BoardMovingStep:!this.isMovingRight&&e<-o.SceneMaxOffsetX&&(this.isMovingRight=!0),this.type===o.BoardType.SPRING&&(this.springHelix.transform.localPositionX=this.getPos().x,this.springTop.transform.localPositionX=this.getPos().x),this.setCenterPos(),this.hasDiamond&&this.setDiamondPos()}},t.prototype.effectDiamondRotate=function(){for(var e=0;e<5;e++)this.diamondList[e].transform.localRotationEulerY+=o.DiamondRotateStepY},t.prototype.hideDiamond=function(e){this.diamondList[e].active=!1;var t=i.default.instance.playerCompo.diamondParticle;t.transform.localPosition=this.diamondList[e].transform.localPosition.clone(),t.particleSystem.play()},t.prototype.checkDiamond=function(e){if(this.hasDiamond){for(var t=!0,a=0;a<5;a++)this.diamondList[a].active&&(t=!1,Math.abs(e-this.diamondList[a].transform.localPositionX)<=o.DiamondScoreArea&&(this.hideDiamond(a),i.default.instance.addDiamond(1)));t&&(this.hasDiamond=!1)}},t.prototype.getPos=function(){return this.board.transform.localPosition.clone()},t.prototype.getType=function(){return this.type},t.prototype.getHeight=function(){return this.type===o.BoardType.DROP?o.BoardHeight*o.BoardHeightScaleDROP:o.BoardHeight*o.BoardHeightScale},t.prototype.getRadius=function(){return this.type===o.BoardType.GIANT?o.BoardRadius*o.BoardRadiusScaleGiant:o.BoardRadius*o.BoardRadiusScale},t.prototype.revive=function(){this.isActive=!1,this.isMoving=!1,this.type===o.BoardType.DROP&&(this.currDropFrame=o.BoardDropFrames,this.board.transform.localPosition=this.posBeforeDrop.clone())},t}(Laya.Script);a.default=r},{"../Const":3,"../runtime/GameScene":10,"../util/Util":15}],6:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("../component/Board"),i=e("../Const"),n=e("../runtime/GameScene"),r=e("../util/Util"),s=function(e){function t(){var t=e.call(this)||this;return t.boardList=[],t.diamondSprintList=[],console.log("BoardBox constructor()"),t}return __extends(t,e),t.prototype.onAwake=function(){console.log("BoardBox onAwake()"),this.boardBox=this.owner},t.prototype.onEnable=function(){console.log("BoardBox onEnable()"),this.init()},t.prototype.init=function(){this.initBoard(),this.initDiamond()},t.prototype.initBoard=function(){for(var e=0;e<i.BoardNum;e++){var t=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCylinder(i.BoardRadius,i.BoardHeight));this.boardBox.addChild(t);var a=t.addComponent(o.default);this.boardList.push(a)}this.reset()},t.prototype.initDiamond=function(){var e,t=this;Laya.Mesh.load(i.URL_DiamondMesh,Laya.Handler.create(this,function(a){(e=new Laya.MeshSprite3D(a)).transform.localScale=new Laya.Vector3(1,1,1);var o=new Laya.BlinnPhongMaterial,r=n.default.instance.skyCount%n.default.instance.skyNum;o.albedoColor=i.DiamondColor[r],o.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,e.meshRenderer.material=o;for(var s=0;s<i.DiamondNum;s++)t.diamondSprintList[s]=e.clone(),t.boardBox.addChild(t.diamondSprintList[s]),t.diamondSprintList[s].active=!1}))},t.prototype.reset=function(){for(var e,t=i.BoardType.NORMAL,a=i.BoardInitPos.clone(),o=0;o<i.BoardNum;o++){e=this.boardList[o];var r=new Laya.BlinnPhongMaterial,s=n.default.instance.skyCount%n.default.instance.skyNum;r.albedoColor=i.BoardColor[s],r.specularColor=new Laya.Vector4(0,0,0,0),e.board.meshRenderer.material=r,e.reset(t,a,1),a=this.getNextPos(e,1),e.getType()}if(e=this.boardList[0],e.isActive=!0,n.default.instance.playerCompo.currBoard=e,e.hasDiamond)for(o=0;o<5;o++)e.hideDiamond(o);if(this.diamondSprintList[0])for(o=0;o<i.DiamondNum;o++){this.diamondSprintList[o].active=!1;s=n.default.instance.skyCount%n.default.instance.skyNum;this.diamondSprintList[o].meshRenderer.material.albedoColor=i.DiamondColor[s]}},t.prototype.getNextPos=function(e,t){var a=e.getPos(),o=r.getDiffCoeff(t,1,2);return a.x=(Math.random()-.5)*i.SceneMaxOffsetX*o,e.getType()===i.BoardType.SUPERMAN&&(a.y+=i.BoardGapSprint,a.x=e.getPos().x),e.getType()===i.BoardType.SPRING?a.y+=i.BoardGapSpring:a.y+=i.BoardGap,a},t.prototype.newBoard=function(e,t){var a=this.getNextPos(this.boardList[i.BoardNum-1],t),o=this.boardList[i.BoardNum-1].getType(),n=this.boardList.shift();e===i.BoardType.SUPERMAN&&(this.diamondCenterX=a.x,this.setDiamond(a)),o===i.BoardType.SUPERMAN?n.reset(e,a,0):n.reset(e,a,t),this.boardList.push(n)},t.prototype.setDiamond=function(e){var t=e.clone();t.y+=i.PlayerJumpStepSprint*i.DiamondStartFrame;for(var a=0;a<i.DiamondNum;a++)this.setNextDiamondPos(t),this.diamondSprintList[a].transform.localPosition=t.clone(),this.diamondSprintList[a].active=!0},t.prototype.newDiamond=function(){var e=this.diamondSprintList[i.DiamondNum-1].transform.localPosition.clone();this.setNextDiamondPos(e);var t=this.diamondSprintList.shift();t.transform.localPosition=e,t.active=!0,this.diamondSprintList.push(t)},t.prototype.clearDiamond=function(){for(var e=0;e<i.DiamondNum;e++)this.diamondSprintList[e].active=!1},t.prototype.setNextDiamondPos=function(e){e.y+=i.DiamondSprintStepY,e.x+=1.5*(Math.random()-.5),e.x>this.diamondCenterX+i.SceneMaxOffsetX?e.x=this.diamondCenterX+i.SceneMaxOffsetX:e.x<this.diamondCenterX-i.SceneMaxOffsetX&&(e.x=this.diamondCenterX-i.SceneMaxOffsetX)},t.prototype.getBoardBox=function(){return this.boardBox},t.prototype.getBoardList=function(){return this.boardList},t.prototype.getDiamondSprintList=function(){return this.diamondSprintList},t}(Laya.Script);a.default=s},{"../Const":3,"../component/Board":5,"../runtime/GameScene":10,"../util/Util":15}],7:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("../Const"),i=e("../runtime/GameScene"),n=function(e){function t(){var t=e.call(this)||this;return t.currMoveFrame=0,t.preType=o.BoardType.NORMAL,console.log("CameraBox constructor()"),t}return __extends(t,e),t.prototype.onAwake=function(){console.log("CameraBox onAwake()"),this.cameraBox=this.owner,this.init()},t.prototype.init=function(){var e=this.cameraBox.addChild(new Laya.Camera(0,.3,100));e.transform.localPosition=o.CameraInitPos.clone(),e.transform.localRotationEuler=o.CameraInitRot.clone(),e.clearFlag=Laya.BaseCamera.CLEARFLAG_SKY;var t=new Laya.BlinnPhongMaterial;t.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,t.albedoColor=new Laya.Vector4(1,1,1,0),e.skyRenderer.material=t;var a=Laya.Browser.width/Laya.Browser.height;if(a<.5625){var i=2*Math.atan(.5625*Math.tan(.5235987));e.fieldOfView=2*Math.atan(Math.tan(i/2)/a)*57.29578}this.camera=e,this.destinationPos=new Laya.Vector2,this.destinationPos.x=this.camera.transform.localPositionX,this.destinationPos.y=this.camera.transform.localPositionY},t.prototype.reset=function(){this.camera.transform.localPosition=o.CameraInitPos.clone(),this.destinationPos=o.CameraInitPos.clone()},t.prototype.onUpdate=function(){if(Math.abs(this.camera.transform.localPositionX-this.destinationPos.x)<=o.CameraMoveXMinErr)this.camera.transform.localPositionX=this.destinationPos.x;else{var e=this.destinationPos.x-this.camera.transform.localPositionX;this.camera.transform.localPositionX+=e/o.CameraMoveXFrames,i.default.instance.front_top.x+=10*e/o.CameraMoveXFrames,i.default.instance.front_bottom.x+=20*e/o.CameraMoveXFrames,i.default.instance.bg_bottom.x+=10*e/o.CameraMoveXFrames}if(Math.abs(this.camera.transform.localPositionY-this.destinationPos.y)<=o.CameraMoveYMinErr)this.camera.transform.localPositionY=this.destinationPos.y;else{var t=this.destinationPos.y-this.camera.transform.localPositionY;this.preType===o.BoardType.SPRING?this.camera.transform.localPositionY+=t/o.CameraMoveYFramesSpring:this.camera.transform.localPositionY+=t/o.CameraMoveYFrames}},t.prototype.setPosX=function(e){this.camera.transform.localPositionX=e,this.destinationPos.x=e},t.prototype.setDesPosX=function(e){this.destinationPos.x=e},t.prototype.setDesPosY=function(e){this.destinationPos.y=e},t}(Laya.Script);a.default=n},{"../Const":3,"../runtime/GameScene":10}],8:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("../Const"),i=e("../runtime/GameScene"),n=e("../util/Util"),r=function(e){function t(){var t=e.call(this)||this;return t.diamondParticleList=[],t.diamondParticleSprintList=[],t.scoreMeshList=[],t.scoreMeshPool={1:new Array,2:new Array,3:new Array,4:new Array,5:new Array},t.currBoardIdx=0,t.isJumpSpring=!1,t.currJumpFrame=0,t.boardNewType=o.BoardType.NORMAL,t.boardGroupCount=0,t.isTouch=!1,t.diffLevel=1,t.hasSprint=!1,t.isPieceDrop=!1,t.preType=o.BoardType.NORMAL,console.log("Player constructor()"),t}return __extends(t,e),t.prototype.onAwake=function(){console.log("Player onAwake()"),this.player=this.owner,this.init()},t.prototype.registerListener=function(){i.default.instance.on(Laya.Event.MOUSE_DOWN,this,this.onTouchDown),i.default.instance.on(Laya.Event.MOUSE_UP,this,this.onTouchUp)},t.prototype.onTouchDown=function(){this.isTouch=!0,this.touchPosX=Laya.stage.mouseX},t.prototype.onTouchUp=function(){this.isTouch=!1},t.prototype.init=function(){this.registerListener(),this.initTrail(),this.playerMeshType=o.PlayerMeshType.CAT,this.loadPlayerMesh(),this.reset(),this.initDiamondParticle(),this.initScore()},t.prototype.initTrail=function(){var e=this;Laya.TrailSprite3D.load(o.URL_Trail,Laya.Handler.create(this,function(t){e.playerTrail=t,e.playerTrail.trailFilter.colorGradient.updateColorRGB(0,0,o.TrailColor[e.playerMeshType]),e.playerTrail.trailFilter.colorGradient.updateColorRGB(1,1,o.TrailColor[e.playerMeshType]),e.player.addChild(e.playerTrail)}))},t.prototype.initDiamondParticle=function(){for(var e=this,t=function(t){Laya.Sprite3D.load(o.URL_Particle[t],Laya.Handler.create(a,function(a){e.diamondParticleList[t]=a,e.player.parent.addChild(e.diamondParticleList[t]),e.diamondParticle=e.diamondParticleList[0]})),Laya.Sprite3D.load(o.URL_ParticleSprint[t],Laya.Handler.create(a,function(a){e.diamondParticleSprintList[t]=a,e.player.parent.addChild(e.diamondParticleSprintList[t]),e.diamondParticleSprint=e.diamondParticleSprintList[0]}))},a=this,n=0;n<i.default.instance.skyNum;n++)t(n)},t.prototype.loadPlayerMesh=function(){var e=this;Laya.Mesh.load(o.URL_PlayerModel[this.playerMeshType],Laya.Handler.create(this,function(t){e.playerMesh=e.owner.addChild(new Laya.MeshSprite3D(t)),Laya.loader.create(o.URL_PlayerMaterial[e.playerMeshType],Laya.Handler.create(e,function(t){var a=new Laya.BlinnPhongMaterial;a.albedoTexture=t,a.specularColor=new Laya.Vector4(0,0,0,0),e.playerMesh.meshRenderer.material=a})),e.playerMesh.transform.localScale=new Laya.Vector3(1.5,1.5,1.5)}))},t.prototype.changePlayer=function(e){var t=this;this.playerMeshType!==e&&(o.URL_PlayerModel[this.playerMeshType]===o.URL_PlayerModel[e]?(this.playerMeshType=e,Laya.loader.create(o.URL_PlayerMaterial[this.playerMeshType],Laya.Handler.create(this,function(e){t.playerMesh.meshRenderer.material.albedoTexture=e}))):(this.playerMeshType=e,this.playerMesh.destroy(!0),"ball"===o.URL_PlayerModel[this.playerMeshType]?(this.playerMesh=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(o.PlayerRadius)),this.owner.addChild(this.playerMesh),Laya.loader.create(o.URL_PlayerMaterial[this.playerMeshType],Laya.Handler.create(this,function(e){var a=new Laya.BlinnPhongMaterial;a.albedoTexture=e,a.specularColor=new Laya.Vector4(0,0,0,0),t.playerMesh.meshRenderer.material=a}))):this.loadPlayerMesh()),this.playerTrail.trailFilter.colorGradient.updateColorRGB(0,0,o.TrailColor[this.playerMeshType]),this.playerTrail.trailFilter.colorGradient.updateColorRGB(1,1,o.TrailColor[this.playerMeshType]))},t.prototype.reset=function(){var e=o.BoardInitPos.clone();if(e.y+=o.PlayerRadius+o.BoardHeight/2-.001,this.player.transform.localPosition=e,this.player.transform.localRotationEuler=new Laya.Vector3(0,0,0),this.show(),this.diffLevel=1,this.currJumpFrame=0,this.jumpState=o.PlayerJumpState.FALLDOWN,this.hasSprint=!1,this.currBoardIdx=0,this.diamondParticleList[0]){var t=i.default.instance.skyCount%i.default.instance.skyNum;this.diamondParticle=this.diamondParticleList[t],this.diamondParticleSprint=this.diamondParticleSprintList[t],this.diamondParticle.active=!0,this.diamondParticleSprint.active=!0,this.diamondParticle.particleSystem.stop(),this.diamondParticleSprint.particleSystem.stop()}},t.prototype.revive=function(){this.currBoardIdx--,this.currBoard.getType()===o.BoardType.SUPERMAN&&(this.currBoardIdx++,this.currBoard=i.default.instance.boardBoxCompo.getBoardList()[this.currBoardIdx]),this.currBoard.revive();var e=this.currBoard.getPos();e.y+=o.PlayerRadius+this.currBoard.getHeight()/2-.001,this.player.transform.localPosition=e,this.player.transform.localRotationEuler=new Laya.Vector3(0,0,0),this.currJumpFrame=0,this.show();var t=this.currBoard.getPos().y+o.CameraOffsetY;i.default.instance.cameraBoxCompo.setDesPosX(e.x),i.default.instance.cameraBoxCompo.setDesPosY(t)},t.prototype.getPlayer=function(){return this.player},t.prototype.show=function(){this.player.active=!0},t.prototype.hide=function(){this.player.active=!1},t.prototype.onUpdate=function(){if(i.default.instance.state===o.GameState.PLAYING){var e=i.default.instance.boardBoxCompo,t=e.getBoardList();if(this.jumpState===o.PlayerJumpState.SPRINT){this.currJumpFrame>o.PlayerJumpFramesSprint&&(this.jumpState=o.PlayerJumpState.JUMPUP,this.isJumpSpring=!1,this.currJumpFrame=0,this.hasSprint=!1,this.player.transform.localRotationEulerY=-o.PlayerSprintStepY,e.clearDiamond()),this.currJumpFrame++;for(var a=e.getDiamondSprintList(),n=0;n<o.DiamondNum;n++)Math.abs(this.player.transform.localPositionY-a[n].transform.localPositionY)<=o.DiamondSprintScoreArea&&Math.abs(this.player.transform.localPositionX-a[n].transform.localPositionX)<=o.DiamondSprintScoreArea&&(i.default.instance.addDiamond(1),a[n].active=!1,this.diamondParticleSprint.particleSystem.play());this.setPosY(),this.setPosX(),this.setRotY(),this.touchPosX=Laya.stage.mouseX,this.diamondParticleSprint.transform.localPosition=this.player.transform.localPosition.clone();var r=this.player.transform.localPositionY+o.CameraOffsetYSprint;i.default.instance.cameraBoxCompo.setDesPosY(r)}else{for(var s=this.currBoardIdx+1;s>=0;s--){var l=this.player.transform.localPosition.clone(),c=t[s].getPos();if(Math.abs(l.x-c.x)<=t[s].getRadius()&&Math.abs(l.y-(c.y+o.BoardHeight))<=o.DiamondScoreArea&&t[s].checkDiamond(this.player.transform.localPositionX),this.jumpState===o.PlayerJumpState.FALLDOWN){if(this.currJumpFrame>o.PlayerMaxDownFrames||this.currBoard.getPos().y-this.player.transform.localPositionY>o.BoardGap+o.BoardHeight)return this.diamondParticle.active=!1,this.diamondParticleSprint.active=!1,void i.default.instance.gameDie();if(this.isOnBoard(t[s])){this.currBoard=t[s],this.currBoardIdx=s,this.activeCurrBoard();break}}}if(this.currJumpFrame++,this.jumpState===o.PlayerJumpState.JUMPUP&&(this.isJumpSpring&&this.currJumpFrame>=o.PlayerJumpFramesSpring?(this.jumpState=o.PlayerJumpState.FALLDOWN,this.currJumpFrame=0):!this.isJumpSpring&&this.currJumpFrame>=o.PlayerJumpFrames&&(this.jumpState=o.PlayerJumpState.FALLDOWN,this.currJumpFrame=0)),this.setPosY(),this.setPosX(),this.setRotZ(),this.touchPosX=Laya.stage.mouseX,this.currBoard.getType()!==o.BoardType.SUPERMAN){var u=this.player.transform.localPositionX;i.default.instance.cameraBoxCompo.setDesPosX(u)}this.isTouch&&(this.touchPosX=Laya.stage.mouseX)}}},t.prototype.isOnBoard=function(e){var t=this.player.transform.localPosition.clone(),a=e.getPos(),i=Math.abs(t.x-a.x),n=t.y-a.y;if(i<=e.getRadius()){if(n>=0&&n<=o.PlayerRadius+e.getHeight()/2)return!0;if(this.isJumpSpring&&this.currJumpFrame>=o.PlayerJumpFramesSpring){if(Math.abs(n)<o.PlayerJumpStepSpring[0])return!0}else if(!this.isJumpSpring&&this.currJumpFrame>=o.PlayerJumpFrames&&Math.abs(n)<o.PlayerJumpStep[0])return!0}return!1},t.prototype.activeCurrBoard=function(){var e=this.player.transform.localPosition.clone(),t=this.currBoard.getPos(),a=this.currBoard.getType();if(this.player.transform.localPositionY=t.y+o.PlayerRadius+this.currBoard.getHeight()/2-.01,this.currJumpFrame=0,a===o.BoardType.SUPERMAN){this.jumpState=o.PlayerJumpState.SPRINT,this.player.transform.localRotationEulerZ=0;var n=t.x;i.default.instance.cameraBoxCompo.setDesPosX(n)}else this.jumpState=o.PlayerJumpState.JUMPUP;if(!1===this.currBoard.isActive){this.currBoard.isActive=!0;var r=o.ScoreBoardNotCenter;a!==o.BoardType.NORMAL&&a!==o.BoardType.DROP||Math.abs(e.x-t.x)<=o.BoardRadiusCenter&&(r=o.ScoreBoardCenter),i.default.instance.addScore(r),this.showScore(r),this.diffLevel+=r/2;for(l=this.currBoardIdx-o.BoardNewIndex;l>0;l--)this.newBoard()}this.isJumpSpring=a===o.BoardType.SPRING,this.currBoard.setBump(),this.currBoard.setWave(),a!==o.BoardType.SPRING&&a!==o.BoardType.SUPERMAN||this.currBoard.setSpring();var s=i.default.instance.boardBoxCompo.getBoardList();if(a===o.BoardType.DROP)for(var l=0;l<this.currBoardIdx;l++)s[l].setDrop();var c=t.y+o.CameraOffsetY;i.default.instance.cameraBoxCompo.setDesPosY(c),i.default.instance.cameraBoxCompo.preType=a},t.prototype.newBoard=function(){if(this.boardGroupCount<=0){var e=n.getDiffCoeff(this.diffLevel,1,10),t=Math.random()*e;t<=4.2?(this.boardNewType=o.BoardType.NORMAL,this.boardGroupCount=2):t<=5.5?(this.boardNewType=o.BoardType.GIANT,this.boardGroupCount=3):t<=6.2?(this.boardNewType=o.BoardType.SPRING,Math.random()>.5&&(this.boardGroupCount=2)):t<=7?(this.boardNewType=o.BoardType.DROP,this.boardGroupCount=3):t<=7.5?!1===this.hasSprint?(this.boardNewType=o.BoardType.SUPERMAN,this.hasSprint=!0):this.boardNewType=o.BoardType.NORMAL:t<=8?(this.boardNewType=o.BoardType.DWRAF,Math.random()>.4&&(Math.random()>.7?this.boardGroupCount=3:this.boardGroupCount=2)):this.boardNewType=o.BoardType.NORMAL}this.boardGroupCount--;i.default.instance.boardBoxCompo.newBoard(this.boardNewType,this.diffLevel)},t.prototype.initScore=function(){for(var e=this,t=function(t){Laya.Mesh.load("res/model/"+t+"-Text001.lm",Laya.Handler.create(a,function(a){var o=new Laya.MeshSprite3D(a),i=new Laya.BlinnPhongMaterial;i.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,i.albedoColor=new Laya.Vector4(1,1,1,1),o.meshRenderer.material=i,o.transform.rotate(new Laya.Vector3(-10,0,0),!0,!1),o.transform.scale=new Laya.Vector3(1,1,1),o.active=!1,e.scoreMeshList[t-1]=o}))},a=this,o=1;o<=5;o++)t(o)},t.prototype.showScore=function(e){var t,a=this,o=this.player.transform.localPosition.clone();this.scoreMeshPool[e].length?t=this.scoreMeshPool[e].pop():(t=this.scoreMeshList[e-1].clone(),this.player.parent.addChild(t)),o.y+=.75,t.transform.position=o,t.transform.localScale=new Laya.Vector3(1,1,1);Laya.Tween.to(t.transform,{localScaleX:1.5*1.2,localScaleY:1.5*1.2,localScaleZ:1.5*1.2},100,Laya.Ease.linearInOut,Laya.Handler.create(this,function(){Laya.Tween.to(t.transform,{localScaleX:1.5,localScaleY:1.5,localScaleZ:1.5},100,Laya.Ease.linearInOut,Laya.Handler.create(a,function(){Laya.Tween.to(t.transform,{localScaleX:1.35,localScaleY:1.35,localScaleZ:1.35},200,Laya.Ease.linearInOut,Laya.Handler.create(a,function(){t.active=!1,t.transform.localScale=new Laya.Vector3(1,1,1),a.scoreMeshPool[e].push(t)}))}))})),t.meshRenderer.material.albedoColor=new Laya.Vector4(1,1,1,.8),Laya.timer.once(150,this,function(){Laya.Tween.to(t.meshRenderer.material,{albedoColorR:1,albedoColorG:1,albedoColorB:1,albedoColorA:0},250,Laya.Ease.linearInOut)}),t.active=!0},t.prototype.showScoreDiamond=function(e){var t,a=this;this.scoreMeshPool[e].length?t=this.scoreMeshPool[e].pop():(t=this.scoreMeshList[e-1].clone(),this.player.parent.addChild(t));var o=new Laya.Vector3;o.x=i.default.instance.diamondBox.x+0,o.y=i.default.instance.diamondBox.y-0,t.transform.position=o,t.transform.localScale=new Laya.Vector3(.8,.8,.8),Laya.Tween.to(t.transform,{localPositionY:o.y-30,localScaleX:.3,localScaleY:.3,localScaleZ:.3},400,Laya.Ease.linearInOut,Laya.Handler.create(this,function(){t.active=!1,t.transform.localScale=new Laya.Vector3(1,1,1),a.scoreMeshPool[e].push(t)})),t.meshRenderer.material.albedoColor=new Laya.Vector4(1,1,1,.8),Laya.timer.once(150,this,function(){Laya.Tween.to(t.meshRenderer.material,{albedoColorR:1,albedoColorG:1,albedoColorB:1,albedoColorA:0},250,Laya.Ease.linearInOut)}),t.active=!0},t.prototype.setPosY=function(){if(this.jumpState===o.PlayerJumpState.JUMPUP)this.isJumpSpring?this.player.transform.localPositionY+=o.PlayerJumpStepSpring[Math.floor(this.currJumpFrame/3)]:this.player.transform.localPositionY+=o.PlayerJumpStep[Math.floor(this.currJumpFrame/2)];else if(this.jumpState===o.PlayerJumpState.FALLDOWN)this.currBoard.getType()===o.BoardType.SPRING?this.currJumpFrame<o.PlayerJumpFramesSpring?this.player.transform.localPositionY-=o.PlayerJumpStepSpring[Math.floor((o.PlayerJumpFramesSpring-this.currJumpFrame-1)/3)]:this.player.transform.localPositionY-=o.PlayerJumpStepSpring[0]:this.currJumpFrame<o.PlayerJumpFrames?this.player.transform.localPositionY-=o.PlayerJumpStep[Math.floor((o.PlayerJumpFrames-this.currJumpFrame-1)/2)]:this.player.transform.localPositionY-=o.PlayerJumpStep[0];else if(this.jumpState===o.PlayerJumpState.SPRINT&&(this.player.transform.localPositionY+=o.PlayerJumpStepSprint,this.currJumpFrame>=o.DiamondStartFrame+20&&this.currJumpFrame<=o.PlayerJumpFramesSprint-50&&this.currJumpFrame%Math.floor(o.DiamondSprintStepY/o.PlayerJumpStepSprint)==0)){i.default.instance.boardBoxCompo.newDiamond()}},t.prototype.setRotY=function(){this.player.transform.localRotationEulerY+=o.PlayerSprintStepY},t.prototype.setRotZ=function(){if(this.isTouch&&this.touchPosX!=Laya.stage.mouseX){var e=(Laya.stage.mouseX-this.touchPosX)*o.CoeffRotPlayer;this.player.transform.localRotationEulerZ+=e}},t.prototype.setPosX=function(){if(this.isTouch&&this.touchPosX!=Laya.stage.mouseX)if(this.jumpState===o.PlayerJumpState.SPRINT){a=(Laya.stage.mouseX-this.touchPosX)*o.CoeffPosPlayer;this.player.transform.localPositionX+=a;var e=this.player.transform.localPositionX,t=1.3*o.SceneMaxOffsetX;e>this.currBoard.getPos().x+t?this.player.transform.localPositionX=this.currBoard.getPos().x+t:e<this.currBoard.getPos().x-t&&(this.player.transform.localPositionX=this.currBoard.getPos().x-t)}else{var a=(Laya.stage.mouseX-this.touchPosX)*o.CoeffPosPlayer;this.player.transform.localPositionX+=a}},t}(Laya.Script);a.default=r},{"../Const":3,"../runtime/GameScene":10,"../util/Util":15}],9:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("../util/wx"),i=e("../util/ws.js"),n=e("../Global"),r=e("../util/Ad"),s=function(e){function t(){var a=e.call(this)||this;return a.shareTimestampMap={},a.lastShareTimestamp=0,console.log("Reward constructor()"),t.instance=a,a}return __extends(t,e),t.prototype.onAwake=function(){var e=this;console.log("Reward onAwake()"),Laya.Browser.onMiniGame&&o.default.onShow(function(t){var a=e.shareArgs;if(a&&a.length){var i=a[0]||{},r=i.pos,s=i.success,l=i.fail,c=i.complete;try{var u=Date.now();s||l?u-e.lastShareTimestamp>1e3*(n.default.config.share_delay||5)?(n.default.gameData.shareCount++,n.default.gameData.lastShareTimestamp=u,e.shareTimestampMap[r]=u,s&&s(t),c&&c(t)):(e.shareTimestampMap[r]=0,o.default.showModal({title:"提示",content:n.default.config.share_fail,cancelText:"知道了",confirmText:"重新发送",success:function(o){o.confirm?e.share.apply(e,a):(l&&l(t),c&&c(t))}})):(e.shareTimestampMap[r]=0,c&&c(t))}finally{e.lastShareTimestamp=0,e.shareArgs=null}}})},t.prototype.reward=function(e){var t=e.pos,a=e.query,o=e.success,i=e.fail,n=e.complete;this.isShareState(t)?this.share({pos:t,query:a,success:o,fail:i,complete:n}):this.video({pos:t,success:o,fail:i,complete:n})},t.prototype.share=function(e){var t=e.pos,a=e.query,o=e.success,r=e.fail,s=e.complete;if(!Laya.Browser.onMiniGame)return console.log("Laya.Browser.onMiniGame = false"),r&&r(),void(s&&s());if(!this.isOnline()||!this.allowShare(t))return console.log("今日视频已看完"),r&&r(),void(s&&s());var l=Date.now(),c=Number(this.shareTimestampMap[t]);if(c&&l-c<1e3*n.default.config.share_time)return console.log("请稍等一会再操作"),r&&r(),void(s&&s());(o||r)&&(this.shareTimestampMap[t]=l),this.lastShareTimestamp=Date.now(),this.shareArgs=arguments,i.default.share({pos:t,query:a})},t.prototype.video=function(e){var t=e.pos,a=e.success,o=e.fail,i=e.complete;if(!Laya.Browser.onMiniGame)return console.log("Laya.Browser.onMiniGame = false"),o&&o(),void(i&&i());r.posShowVideo(t,function(){console.log("今日视频已看完"),o&&o(),i&&i()},function(e){e&&e.isEnded||void 0===e?(n.default.gameData.videoCount++,n.default.gameData.lastVideoTimestamp=Date.now(),a&&a()):o&&o(),i&&i()})},t.prototype.allowShare=function(e){var t=n.default.config[e+"_allow_share"];return"boolean"==typeof t?t:n.default.config.allow_share},t.prototype.allowVideo=function(e){var t=n.default.config[e+"_allow_video"];return"boolean"==typeof t?t:n.default.config.allow_video},t.prototype.isOnline=function(){return n.default.config.online},t.prototype.isShareFirst=function(e){var t=n.default.config[e+"_share_first"];return"boolean"==typeof t?t:n.default.config.share_first},t.prototype.getShareCount=function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();return(!n.default.gameData.lastShareTimestamp||n.default.gameData.lastShareTimestamp<t)&&(n.default.gameData.shareCount=0),n.default.gameData.shareCount},t.prototype.isOverShare=function(){return n.default.config.share_number&&n.default.config.share_number<=this.getShareCount()},t.prototype.getVideoCount=function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();return(!n.default.gameData.lastVideoTimestamp||n.default.gameData.lastVideoTimestamp<t)&&(n.default.gameData.videoCount=0),n.default.gameData.videoCount},t.prototype.isOverVideo=function(){return n.default.config.video_number&&n.default.config.video_number<=this.getVideoCount()},t.prototype.hasVideo=function(){return r.hasVideoAd()},t.prototype.isShareState=function(e){return!(!this.isOnline()||!this.allowShare(e))&&(!this.allowVideo(e)||!this.hasVideo()||(this.isShareFirst(e)?!this.isOverShare()||this.isOverVideo():this.isOverVideo()))},t}(Laya.Script);a.default=s},{"../Global":4,"../util/Ad":14,"../util/ws.js":16,"../util/wx":17}],10:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("./../../ui/layaMaxUI"),i=e("../Const"),n=e("../Global"),r=e("../component/CameraBox"),s=e("../component/BoardBox"),l=e("../component/Player"),c=e("./OverView"),u=e("./ReviveView"),d=e("../util/ws.js"),h=function(e){function t(){var a=e.call(this)||this;return a._score=0,a.scoreStep=10,a.reviveCount=0,a.skyCount=0,a.skyNum=2,console.log("GameScene constructor()"),a.hideTutorial(),a.initScene3D(),t.instance=a,a.diamondLabel.changeText(n.default.gameData.diamond+""),Laya.Browser.onMiniGame&&(a.sound=new wx.createInnerAudioContext,a.sound.src=i.URL_BGM),a}return __extends(t,e),t.openInstance=function(e){t.instance?(t.instance.onOpened(e),t.instance.showTutorial()):Laya.Scene.open(i.URL_GameScene,!1,e)},t.prototype.onOpened=function(e){console.log("GameScene onOpened()"),this.visible=!0,this.state=i.GameState.READY},t.prototype.onEnable=function(){this.bindButtons()},t.prototype.bindButtons=function(){var e=this;this.tutorialBox.on(Laya.Event.MOUSE_DOWN,this,function(){e.gameStart()})},t.prototype.initScene3D=function(){this.scene3D=this.scene3DBox.addChild(new Laya.Scene3D);var e=this.scene3D.addChild(new Laya.DirectionLight);e.transform.localPosition=i.DirectionLightPos.clone(),e.transform.localRotationEuler=i.DirectionLightRot.clone(),e.color=i.DirectionLightColor.clone();var t=this.scene3D.addChild(new Laya.Sprite3D);this.cameraBoxCompo=t.addComponent(r.default);var a=this.scene3D.addChild(new Laya.Sprite3D);this.playerCompo=a.addComponent(l.default);var o=this.scene3D.addChild(new Laya.MeshSprite3D);this.boardBoxCompo=o.addComponent(s.default),this.scoreLabel.scale(.8,.8)},t.prototype.resetGame=function(){Laya.Browser.onMiniGame&&(this.sound=new wx.createInnerAudioContext,this.sound.src=i.URL_BGM),this.sound&&this.sound.play(),this.skyCount++;var e=this.skyCount%this.skyNum;this.background.loadImage(i.URL_Background[e]),this.bg_bottom.loadImage(i.URL_BG_Bottom[e]),this.front_top.loadImage(i.URL_Front_Top[e]),this.front_bottom.loadImage(i.URL_Front_bottom[e]),this.front_top.x=-270,this.front_bottom.x=-270,this.bg_bottom.x=-270,this.state=i.GameState.READY,this.score=0,this.scoreLabel.visible=!1,this.cameraBoxCompo.reset(),this.boardBoxCompo.reset(),this.playerCompo.reset()},t.prototype.gameStart=function(){this.sound&&this.sound.play(),this.state=i.GameState.PLAYING,this.hideTutorial(),d.default.traceEvent("Start_Move"),0===this.reviveCount&&(this.startTimestamp=Date.now())},t.prototype.gameDie=function(){var e=this;this.sound&&this.sound.pause(),this.state=i.GameState.PAUSE,this.playerCompo.hide(),Laya.timer.once(500,this,function(){n.default.config.allow_revive&&e.reviveCount<2?u.default.openInstance():e.gameOver()})},t.prototype.gameOver=function(){this.sound&&(this.sound.stop(),this.sound.destroy()),this.state=i.GameState.OVER,this.scoreLabel.visible=!1;var e=this.score;Laya.Browser.onMiniGame&&d.default.postGameScore({id:Date.now()+"",score:e,time:Date.now()-this.startTimestamp}),c.default.openInstance({score:e})},t.prototype.gameRevive=function(){d.default.traceEvent("Revive"),this.reviveCount++,this.state=i.GameState.READY,this.scoreLabel.visible=!1,this.playerCompo.revive(),this.showTutorial()},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},set:function(e){this._score=e,this.scoreLabel.changeText(e+"")},enumerable:!0,configurable:!0}),t.prototype.addScore=function(e){var t=this;this.score=this.score+e,this.score>=this.scoreStep&&(Laya.Tween.to(this.scoreLabel,{scaleX:1.5,scaleY:1.5},100,Laya.Ease.linearInOut,Laya.Handler.create(this,function(){Laya.Tween.to(t.scoreLabel,{scaleX:1,scaleY:1},100,Laya.Ease.linearInOut)})),this.scoreStep+=10)},t.prototype.addDiamond=function(e){n.default.gameData.diamond+=e,this.diamondLabel.changeText(n.default.gameData.diamond+"")},t.prototype.showTutorial=function(){this.tutorialBox.visible=!0,this.scoreLabel.visible=!0},t.prototype.hideTutorial=function(){this.tutorialBox.visible=!1},t}(o.ui.game.GameSceneUI);a.default=h},{"../Const":3,"../Global":4,"../component/BoardBox":6,"../component/CameraBox":7,"../component/Player":8,"../util/ws.js":16,"./../../ui/layaMaxUI":18,"./OverView":12,"./ReviveView":13}],11:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("./../../ui/layaMaxUI"),i=e("./GameScene"),n=e("../Const"),r=e("../util/wx"),s=e("../util/ws.js"),l=e("../Global"),c=e("../util/Ad"),u=e("../util/Util"),d=e("../component/Reward"),h=function(e){function t(){var a=e.call(this)||this;return a.iconInfosList=[],a.currentIconInfoList=[],a.isGameDataLoaded=!1,console.log("HomeView constructor()"),i.default.openInstance(),t.instance=a,a}return __extends(t,e),t.openInstance=function(e){t.instance?(c.posShowBanner(n.BannerPos.HomeView),t.instance.onOpened(e)):Laya.Scene.open(n.URL_HomeView,!1,e)},t.prototype.onOpened=function(e){console.log("HomeView onOpened()"),this.visible=!0},t.prototype.onEnable=function(){console.log("HomeView onEnable()"),this.bindButtons(),Laya.Browser.onMiniGame?this.initWeixin():this.onGameDataLoaded()},t.prototype.bindButtons=function(){var e=this;this.startButton.on(Laya.Event.MOUSE_DOWN,this,function(){i.default.instance&&(s.default.traceEvent("Click_Startgame"),e.hide(),i.default.openInstance())}),this.skinButton.on(Laya.Event.MOUSE_DOWN,this,function(){e.moreSkinOpenAni.play(void 0,!1),e.initMoreSkinIcons()}),this.moreSkinCloseButton.on(Laya.Event.MOUSE_DOWN,this,function(){e.moreSkinCloseAni.play(void 0,!1)}),this.drawerOpenButton.on(Laya.Event.MOUSE_DOWN,this,function(){e.drawerOpenAni.play(void 0,!1),e.initDrawerIcons("game_drawer")}),this.drawerCloseButton.on(Laya.Event.MOUSE_DOWN,this,function(){e.drawerCloseAni.play(void 0,!1),s.default.hideGameAd("game_drawer")}),this.moreGameOpenButton.on(Laya.Event.MOUSE_DOWN,this,function(){e.moreGameOpenAni.play(void 0,!1),e.initMoreGameIcons("game_more")}),this.moreGameCloseButton.on(Laya.Event.MOUSE_DOWN,this,function(){e.moreGameCloseAni.play(void 0,!1),s.default.hideGameAd("game_more")})},t.prototype.hide=function(){c.posHideBanner(n.BannerPos.HomeView),this.visible=!1},t.prototype.initWeixin=function(){r.default.showShareMenu({withShareTicket:!0}),r.default.onShareAppMessage(function(){var e=s.default.createShareOptions({pos:"ShareAppButton"});return{title:e.title,imageUrl:e.imageUrl,query:e.query}}),s.default.init({host:"ws.lesscool.cn",version:n.VERSION,appid:1093,secret:"91abf6fe5f824fa43e50c3a4e573ed19",share:{title:"全民欢乐，天天游戏！",image:"http://oss.lesscool.cn/fcdh/96d172496dbafa4ab9c8335a7133476c.png"}}),this.loginWs()},t.prototype.loginWs=function(){s.default.traceEvent("WS_LOGINING"),r.default.showLoading({title:"登录中",mask:!0}),s.default.onLoginComplete(this.onLoginComplete.bind(this)),s.default.login()},t.prototype.onLoginComplete=function(e){"success"===s.default.getLoginStatus()?(s.default.traceEvent("WS_LOGINED"),r.default.hideLoading(),console.log("ws.conf",s.default.conf),console.log("ws.user",s.default.user),console.log("ws.data",s.default.data),this.loadConfig(),this.loadGameData()):"fail"===s.default.getLoginStatus()&&(s.default.traceEvent("WS_LOGIN_FAIL"),r.default.hideLoading(),r.default.showModal({title:"登陆失败",content:"请允许授权",confirmText:"重新登陆",cancelText:"关闭",success:function(e){r.default.showLoading({title:"登录中",mask:!0}),s.default.login()}}))},t.prototype.loadConfig=function(){Object.assign(l.default.config,s.default.conf)},t.prototype.loadGameData=function(){var e=this;s.default.data&&s.default.data.updateTimestamp||s.default.setAllData(l.default.gameData,!0),l.default.gameData=Object.assign(l.default.gameData,s.default.data),i.default.instance&&i.default.instance.diamondLabel.changeText(l.default.gameData.diamond+""),r.default.onHide(function(){e.updateGameData(!0)}),s.default.onShow(function(){c.refreshCurrentBanner()}),this.initHomeIcons(["home_icon_1","home_icon_2","home_icon_3","home_icon_4","home_icon_5","home_icon_6","home_icon_7","home_icon_8","home_icon_9","home_icon_10"]),this.homeIconBox.visible=!0,this.drawerBox.visible=!0,this.moreGameOpenButton.visible=!0,this.startButton.visible=!0,this.onGameDataLoaded()},t.prototype.onGameDataLoaded=function(){console.log("onGameDataLoaded",l.default.gameData),this.isGameDataLoaded=!0,c.posShowBanner(n.BannerPos.HomeView)},t.prototype.updateGameData=function(e){l.default.gameData.updateTimestamp=Date.now(),e&&console.log("updateGameData",l.default.gameData),Laya.Browser.onMiniGame&&s.default.setAllData(l.default.gameData,e)},t.prototype.onIconClick=function(e,t,a){void 0===a&&(a=!0),s.default.tapGameAd({pos:e,ad:t,redirect:a})},t.prototype.initDrawerIcons=function(e){var t=this;this.drawerList.renderHandler=Laya.Handler.create(this,function(a,o){var i=t.drawerList.array[o];if(i){a.visible=!0,a.on(Laya.Event.MOUSE_DOWN,t,t.onIconClick,[e,i]);var n=a.getChildByName("iconImage");n&&n.loadImage(i.icon);var r=a.getChildByName("titleLabel");r&&r.changeText(i.title);var s=a.getChildByName("tips");if(s){var l=s.getChildByName("tipsLabel");l&&l.changeText(Math.random()>.5?"热门":"NEW")}}else a.visible=!1},[],!1),s.default.getGameAd({pos:e,count:l.default.config.games[e].length,success:function(e){var a=e.data;t.drawerList.array=a,t.drawerList.refresh()}})},t.prototype.initMoreSkinIcons=function(){var e=this;this.moreSkinList.renderHandler=Laya.Handler.create(this,function(t,a){var o=e.moreSkinList.array[a];if(o){t.visible=!0,t.on(Laya.Event.MOUSE_DOWN,e,e.onSkinClick,[t,o.idx]);var i=t.getChildByName("iconImage");i&&i.loadImage(n.URL_PlayerIcon[o.idx],Laya.Handler.create(e,function(){if(!1===l.default.gameData.skinUnlock[a].state){(e=t.getChildByName("iconMaskImage"))&&(e.visible=!0);o=t.getChildByName("unlockMsg");"diamond"===l.default.gameData.skinUnlock[a].cost?o&&(o.text=l.default.gameData.skinUnlock[a].value+"钻解锁"):"score"===l.default.gameData.skinUnlock[a].cost?o&&(o.text=l.default.gameData.skinUnlock[a].value+"分解锁"):"video"===l.default.gameData.skinUnlock[a].cost&&o&&(o.text="视频解锁")}else{var e=t.getChildByName("iconMaskImage");e&&(e.visible=!1);var o;(o=t.getChildByName("unlockMsg"))&&(o.text="已解锁")}}))}else t.visible=!1},[],!1);for(var t=[],a=0;a<n.PlayerMeshTypeNum;a++)t.push({idx:a});this.moreSkinList.array=t,this.moreSkinList.refresh()},t.prototype.onSkinClick=function(e,t){var a=this;if(l.default.gameData.skinUnlock[t].state){var o=this.moreSkinPanel.getChildByName("panelImage").getChildByName("selected");o.x=this.moreSkinList.spaceX+e.x+e.width-o.width/2,o.y=this.moreSkinList.spaceY+e.y+o.height/2;var r=e.getChildByName("iconImage");Laya.Tween.to(r,{scaleX:1.1,scaleY:1.1},100,Laya.Ease.linearInOut,Laya.Handler.create(this,function(){Laya.Tween.to(r,{scaleX:1,scaleY:1},100,Laya.Ease.linearInOut)})),i.default.instance.playerCompo.changePlayer(t)}else"diamond"===l.default.gameData.skinUnlock[t].cost&&l.default.gameData.diamond>=l.default.gameData.skinUnlock[t].value?(l.default.gameData.diamond-=l.default.gameData.skinUnlock[t].value,this.unlockSkin(e,t)):"video"===l.default.gameData.skinUnlock[t].cost&&d.default.instance.video({pos:n.RewardPos.Revive,success:function(){a.unlockSkin(e,t)}})},t.prototype.unlockSkin=function(e,t){l.default.gameData.skinUnlock[t].state=!0;var a=e.getChildByName("unlockMsg");a&&(a.text="已解锁");var o=e.getChildByName("iconMaskImage");o&&(o.visible=!1)},t.prototype.initMoreGameIcons=function(e){var t=this;this.moreGameList.renderHandler=Laya.Handler.create(this,function(a,o){var i=t.moreGameList.array[o];if(i){a.visible=!0,a.on(Laya.Event.MOUSE_DOWN,t,t.onIconClick,[e,i]);var n=a.getChildByName("iconImage");n&&n.loadImage(i.icon);var r=a.getChildByName("titleLabel");r&&r.changeText(i.title);var s=a.getChildByName("tips");if(s){var l=s.getChildByName("tipsLabel");l&&l.changeText(Math.random()>.5?"热门":"NEW")}}else a.visible=!1},[],!1),s.default.getGameAd({pos:e,count:l.default.config.games[e].length,success:function(e){var a=e.data;t.moreGameList.array=a,t.moreGameList.refresh()}})},t.prototype.initHomeIcons=function(e){var t=this;if(e&&e.length){for(var a=[],o=0,i=e;o<i.length;o++){var n=i[o],r=l.default.config.games[n],c=r&&r.length?r.length:1;a.push({pos:n,count:c})}this.homeIconList.renderHandler=Laya.Handler.create(this,function(a,o){var i=t.homeIconList.array[o];if(i){a.visible=!0,a.on(Laya.Event.MOUSE_DOWN,t,t.onIconClick,[e[o],i]);var n=a.getChildByName("iconImage");n&&n.loadImage(i.icon);var r=a.getChildByName("titleLabel");r&&r.changeText(i.title),u.shakeOnce(1e3*Math.random(),a)}else a.visible=!1},[],!1),s.default.fetchGameAd({data:a,success:function(a){for(var o=a.data,i=[],n=0,r=e;n<r.length;n++){var s=r[n];i.push(o[s])}t.iconInfosList=i,t.currentIconInfoList=[],t.scheduleRefreshHomeIcons()}})}},t.prototype.scheduleRefreshHomeIcons=function(){var e=this;this.refreshHomeIcons(),Laya.timer.loop(3e3,this,function(){e.visible&&e.refreshHomeIcons()})},t.prototype.refreshHomeIcons=function(){for(var e=0;e<this.iconInfosList.length;e++){var t=this.iconInfosList[e],a=u.getRandom(t);this.currentIconInfoList[e]=a}this.homeIconList.array=this.currentIconInfoList,this.homeIconList.refresh()},t}(o.ui.home.HomeViewUI);a.default=h},{"../Const":3,"../Global":4,"../component/Reward":9,"../util/Ad":14,"../util/Util":15,"../util/ws.js":16,"../util/wx":17,"./../../ui/layaMaxUI":18,"./GameScene":10}],12:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("./../../ui/layaMaxUI"),i=e("./GameScene"),n=e("../Const"),r=e("../util/ws.js"),s=e("../Global"),l=e("./HomeView"),c=e("../util/Ad"),u=e("../util/Util"),d=function(e){function t(){var a=e.call(this)||this;return a.isInitIcons=!1,a.iconInfosList=[],a.currentIconInfoList=[],a.guessLikeIconInfosList=[],a.currentGuessLikeIconInfoList=[],console.log("OverView constructor()"),t.instance=a,a}return __extends(t,e),t.openInstance=function(e){t.instance?t.instance.onOpened(e):Laya.Scene.open(n.URL_OverView,!1,e)},t.prototype.onOpened=function(e){var t=this,a=e.score,o=void 0===a?0:a;console.log("OverView onOpened()"),Laya.Browser.onMiniGame&&r.default.isIPhoneX()&&(this.bottomButtonBox.bottom=250+s.default.config.distance_iphonex||0),!this.isInitIcons&&Laya.Browser.onMiniGame&&(this.isInitIcons=!0,this.initOverIcons(["Restart_icon5","Restart_icon6","Restart_icon7","Restart_icon8","Restart_icon9","Restart_icon10"]),this.initGuessLikeIcons(["Restart_icon1","Restart_icon2","Restart_icon3","Restart_icon4"])),this.scoreLabel.changeText(o+""),this.visible=!0,s.default.config.online&&Math.random()<s.default.config.banner_delay_ratio?(this.buttonsDownAni.play(void 0,!1),Laya.timer.once(1e3*(s.default.config.banner_delay-1/6),this,function(){c.posShowBanner(n.BannerPos.OverView),t.buttonsUpAni.play(void 0,!1)})):c.posShowBanner(n.BannerPos.OverView),s.default.gameData.skinUnlock.forEach(function(e,t){"score"===e.cost&&!1===e.state&&o>=e.value&&(e.state=!0)})},t.prototype.onEnable=function(){this.bindButtons()},t.prototype.bindButtons=function(){var e=this;this.restartButton.on(Laya.Event.MOUSE_DOWN,this,function(){e.restartGame()}),this.homeButton.on(Laya.Event.MOUSE_DOWN,this,function(){e.toHome()}),this.shareButton.on(Laya.Event.MOUSE_DOWN,this,function(){r.default.share({pos:n.RewardPos.OverShare})})},t.prototype.restartGame=function(){r.default.traceEvent("Click_Restart"),this.hide(),i.default.instance.resetGame(),i.default.openInstance()},t.prototype.toHome=function(){this.hide(),i.default.instance.resetGame(),l.default.openInstance()},t.prototype.hide=function(){c.posHideBanner(n.BannerPos.OverView),this.visible=!1},t.prototype.onIconClick=function(e,t,a){void 0===a&&(a=!0),r.default.tapGameAd({pos:e,ad:t,redirect:a})},t.prototype.initGuessLikeIcons=function(e){var t=this;if(e&&e.length){for(var a=[],o=0,i=e;o<i.length;o++){var n=i[o],l=s.default.config.games[n],c=l&&l.length?l.length:1;a.push({pos:n,count:c})}this.guessLikeList.renderHandler=Laya.Handler.create(this,function(a,o){var i=t.guessLikeList.array[o];if(i){a.visible=!0,a.on(Laya.Event.MOUSE_DOWN,t,t.onIconClick,[e[o],i]);var n=a.getChildByName("iconImage");n&&n.loadImage(i.icon);var r=a.getChildByName("titleLabel");r&&r.changeText(i.title),u.jumpeOnce(150*o,a)}else a.visible=!1},[],!1),r.default.fetchGameAd({data:a,success:function(a){for(var o=a.data,i=[],n=0,r=e;n<r.length;n++){var s=r[n];i.push(o[s])}t.guessLikeIconInfosList=i,t.currentGuessLikeIconInfoList=[],t.scheduleRefreshGuessLikeIcons()}})}},t.prototype.scheduleRefreshGuessLikeIcons=function(){var e=this;this.refreshGuessLikeIcons(),Laya.timer.loop(3e3,this,function(){e.visible&&e.refreshGuessLikeIcons()})},t.prototype.refreshGuessLikeIcons=function(){for(var e=0;e<this.guessLikeIconInfosList.length;e++){var t=this.guessLikeIconInfosList[e],a=u.getRandom(t);this.currentGuessLikeIconInfoList[e]=a}this.guessLikeList.array=this.currentGuessLikeIconInfoList,this.guessLikeList.refresh()},t.prototype.initOverIcons=function(e){var t=this;if(e&&e.length){for(var a=[],o=0,i=e;o<i.length;o++){var n=i[o],l=s.default.config.games[n],c=l&&l.length?l.length:1;a.push({pos:n,count:c})}this.overIconList.renderHandler=Laya.Handler.create(this,function(a,o){var i=t.overIconList.array[o];if(i){a.visible=!0,a.on(Laya.Event.MOUSE_DOWN,t,t.onIconClick,[e[o],i]);var n=a.getChildByName("iconImage");n&&n.loadImage(i.icon);var r=a.getChildByName("titleLabel");r&&r.changeText(i.title),u.shakeOnce(1e3*Math.random(),a)}else a.visible=!1},[],!1),r.default.fetchGameAd({data:a,success:function(a){for(var o=a.data,i=[],n=0,r=e;n<r.length;n++){var s=r[n];i.push(o[s])}t.iconInfosList=i,t.currentIconInfoList=[],t.scheduleRefreshOverIcons()}})}},t.prototype.scheduleRefreshOverIcons=function(){var e=this;this.refreshOverIcons(),Laya.timer.loop(3e3,this,function(){e.visible&&e.refreshOverIcons()})},t.prototype.refreshOverIcons=function(){for(var e=0;e<this.iconInfosList.length;e++){var t=this.iconInfosList[e],a=u.getRandom(t);this.currentIconInfoList[e]=a}this.overIconList.array=this.currentIconInfoList,this.overIconList.refresh()},t}(o.ui.over.OverViewUI);a.default=d},{"../Const":3,"../Global":4,"../util/Ad":14,"../util/Util":15,"../util/ws.js":16,"./../../ui/layaMaxUI":18,"./GameScene":10,"./HomeView":11}],13:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("./../../ui/layaMaxUI"),i=e("./GameScene"),n=e("../Const"),r=e("../util/ws.js"),s=e("../Global"),l=e("../component/Reward"),c=e("../util/Ad"),u=e("../util/Util"),d=function(e){function t(){var a=e.call(this)||this;return a.isInitIcons=!1,a.iconInfosList=[],a.currentIconInfoList=[],a.stopped=!1,a.countdownTimer=0,a.countdownNumber=0,console.log("ReviveView constructor()"),t.instance=a,a}return __extends(t,e),t.openInstance=function(e){t.instance?t.instance.onOpened(e):Laya.Scene.open(n.URL_ReviveView,!1)},t.prototype.onOpened=function(e){var t=this;console.log("ReviveView onOpened()"),Laya.Browser.onMiniGame&&r.default.isIPhoneX()&&(this.bottomButtonBox.bottom=250+s.default.config.distance_iphonex||0),!this.isInitIcons&&Laya.Browser.onMiniGame&&(this.isInitIcons=!0,this.initReiveIcons(["relive_icon1","relive_icon2","relive_icon3","relive_icon4","relive_icon5","relive_icon6","relive_icon7","relive_icon8","relive_icon9","relive_icon10"])),s.default.config.online&&Math.random()<s.default.config.banner_delay_ratio1?(this.buttonsDownAni.play(void 0,!1),Laya.timer.once(1e3*(s.default.config.banner_delay-1/6),this,function(){c.posShowBanner(n.BannerPos.ReviveDialog),t.buttonsUpAni.play(void 0,!1)})):c.posShowBanner(n.BannerPos.ReviveDialog),this.shareButton.visible=l.default.instance.isOnline()&&l.default.instance.allowShare(),this.resetCountdown(),this.visible=!0},t.prototype.onEnable=function(){console.log("ReviveView onEnable()"),this.bindButtons()},t.prototype.hide=function(){c.posHideBanner(n.BannerPos.ReviveDialog),this.stopped=!0,this.visible=!1},t.prototype.bindButtons=function(){var e=this;this.skipButton.on(Laya.Event.MOUSE_DOWN,this,function(){e.hide(),r.default.traceEvent("Click_Skipnow"),i.default.instance.gameOver()}),this.shareButton.on(Laya.Event.MOUSE_DOWN,this,function(){e.stopped=!0,l.default.instance.share({pos:n.RewardPos.Revive,success:function(){e.hide(),i.default.instance.gameRevive()},complete:function(){e.stopped=!1}})}),this.videoButton.on(Laya.Event.MOUSE_DOWN,this,function(){e.stopped=!0,l.default.instance.video({pos:n.RewardPos.Revive,success:function(){e.hide(),i.default.instance.gameRevive()},complete:function(){e.stopped=!1}})})},t.prototype.resetCountdown=function(){Laya.timer.clear(this,this.countdown),this.countdownAni.isPlaying&&this.countdownAni.stop(),this.countdownTimer=n.ReviveCountdown,this.countdownNumber=n.ReviveCountdown,this.stopped=!1,this.countdownLabel.changeText(this.countdownNumber+""),Laya.timer.frameLoop(1,this,this.countdown)},t.prototype.countdown=function(){var e=Laya.timer.delta;if(this.visible&&!this.stopped)if(this.countdownTimer-=.001*e,this.countdownTimer<0)this.hide(),i.default.instance.gameOver();else{var t=Math.floor(this.countdownTimer);t!==this.countdownNumber&&(this.countdownNumber=t,this.countdownLabel.changeText(this.countdownNumber+""),this.countdownAni.play(void 0,!1))}},t.prototype.onIconClick=function(e,t,a){void 0===a&&(a=!0),r.default.tapGameAd({pos:e,ad:t,redirect:a})},t.prototype.initReiveIcons=function(e){var t=this;if(e&&e.length){for(var a=[],o=0,i=e;o<i.length;o++){var n=i[o],l=s.default.config.games[n],c=l&&l.length?l.length:1;a.push({pos:n,count:c})}this.reviveIconList.renderHandler=Laya.Handler.create(this,function(a,o){var i=t.reviveIconList.array[o];if(i){a.visible=!0,a.on(Laya.Event.MOUSE_DOWN,t,t.onIconClick,[e[o],i]);var n=a.getChildByName("iconImage");n&&n.loadImage(i.icon);var r=a.getChildByName("titleLabel");r&&r.changeText(i.title),u.shakeOnce(1e3*Math.random(),a)}else a.visible=!1},[],!1),r.default.fetchGameAd({data:a,success:function(a){for(var o=a.data,i=[],n=0,r=e;n<r.length;n++){var s=r[n];i.push(o[s])}t.iconInfosList=i,t.currentIconInfoList=[],t.scheduleRefreshReviveIcons()}})}},t.prototype.scheduleRefreshReviveIcons=function(){var e=this;this.refreshReviveIcons(),Laya.timer.loop(3e3,this,function(){e.visible&&e.refreshReviveIcons()})},t.prototype.refreshReviveIcons=function(){for(var e=0;e<this.iconInfosList.length;e++){var t=this.iconInfosList[e],a=u.getRandom(t);this.currentIconInfoList[e]=a}this.reviveIconList.array=this.currentIconInfoList,this.reviveIconList.refresh()},t}(o.ui.dialog.ReviveViewUI);a.default=d},{"../Const":3,"../Global":4,"../component/Reward":9,"../util/Ad":14,"../util/Util":15,"../util/ws.js":16,"./../../ui/layaMaxUI":18,"./GameScene":10}],14:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("./wx"),i=e("./ws.js"),n=e("../Global"),r=!0,s=null,l=0;a.refreshCurrentBanner=function(){s&&l>=n.default.config.banner_click_time?(l=0,a.posShowBanner(s,!0)):l++},a.hasVideoAd=function(){return r},a.posShowBanner=function(e,t){if(void 0===t&&(t=!1),Laya.Browser.onMiniGame){var a=o.default.getSystemInfoSync(),n=a.screenHeight,r=a.screenWidth,l=Math.max(300,r),c=.348*l,u=n-c,d=(r-l)/2;s=e,i.default.createBanner({pos:e,style:{left:d,top:u,width:l,height:c},force:t})}},a.posHideBanner=function(e){Laya.Browser.onMiniGame&&(s=null,i.default.closeBanner(e))},a.posShowVideo=function(e,t,a){Laya.Browser.onMiniGame&&i.default.createVideo?i.default.createVideo({pos:e,success:function(e){a&&a(e)},fail:function(e){r=!1,console.log("NO VIDEO AD")}}):(r=!1,console.log("NO VIDEO AD"),t&&t())}},{"../Global":4,"./ws.js":16,"./wx":17}],15:[function(e,t,a){"use strict";var o=this;Object.defineProperty(a,"__esModule",{value:!0}),a.getDiffCoeff=function(e,t,a){return(a*e+1)/(1*e+((a+1)/t-1))},a.shakeOnce=function(e,t){Laya.timer.once(e,o,function(){Laya.Tween.to(t,{rotation:-10},100,Laya.Ease.linearNone,Laya.Handler.create(o,function(){Laya.Tween.to(t,{rotation:10},200,Laya.Ease.linearNone,Laya.Handler.create(o,function(){Laya.Tween.to(t,{rotation:-5},150,Laya.Ease.linearNone,Laya.Handler.create(o,function(){Laya.Tween.to(t,{rotation:5},100,Laya.Ease.linearNone,Laya.Handler.create(o,function(){Laya.Tween.to(t,{rotation:0},50,Laya.Ease.linearNone,Laya.Handler.create(o,function(){Laya.timer.clearAll(t)}))}))}))}))}))}),a.blinkTips(e,t)},a.jumpeOnce=function(e,t){var i=t.y;Laya.timer.once(e,o,function(){Laya.Tween.to(t,{rotation:-10},100,Laya.Ease.linearNone,Laya.Handler.create(o,function(){Laya.Tween.to(t,{rotation:10},200,Laya.Ease.linearNone,Laya.Handler.create(o,function(){Laya.Tween.to(t,{rotation:-5},150,Laya.Ease.linearNone,Laya.Handler.create(o,function(){Laya.Tween.to(t,{rotation:5},100,Laya.Ease.linearNone,Laya.Handler.create(o,function(){Laya.Tween.to(t,{rotation:0},50,Laya.Ease.linearNone,Laya.Handler.create(o,function(){Laya.timer.clearAll(t)}))}))}))}))})),Laya.Tween.to(t,{y:i-50},200,Laya.Ease.sineOut,Laya.Handler.create(o,function(){Laya.Tween.to(t,{y:i},200,Laya.Ease.sineIn)}))}),a.blinkTips(e,t)},a.blinkTips=function(e,t){var a=t.getChildByName("tips");a&&Laya.timer.once(e,o,function(){Laya.Tween.to(a,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(o,function(){Laya.Tween.to(a,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(o,function(){Laya.Tween.to(a,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(o,function(){Laya.Tween.to(a,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(o,function(){Laya.Tween.to(a,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(o,function(){Laya.Tween.to(a,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(o,function(){Laya.timer.clearAll(a)}))}))}))}))}))}))})},a.randomIndex=function(e,t,a){void 0===t&&(t="weight"),void 0===a&&(a=0);var o=[],i=0;if(e&&e.length)for(l=0;l<e.length;l++){var n=e[l],r=Number(n[t])||a||0;o[l]=[i,i+r],i+=r}if(i>0)for(var s=Math.random()*i,l=0;l<o.length;l++){var c=o[l];if(c[0]<=s&&s<c[1])return l}return 0},a.getRandom=function(e,t,o){return void 0===t&&(t="weight"),void 0===o&&(o=0),e&&e.length?e[a.randomIndex(e,t,o)]:null}},{}],16:[function(e,t,a){t.exports.default=function(e){function t(o){if(a[o])return a[o].exports;var i=a[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";var o,i=(o=a(1))&&o.__esModule?o:{default:o},n=a(4),r=a(5),s=a(6),l=a(7),c=a(8),u=a(9),d=a(10),h=a(11),f=a(12),p=a(13),m=a(2),y=a(14);(0,m.initUtil)(i.default),(0,n.initHTTP)(i.default),(0,r.initUser)(i.default),(0,s.initConfig)(i.default),(0,l.initData)(i.default),(0,c.initShare)(i.default),(0,u.initProcess)(i.default),(0,d.initPayment)(i.default),(0,h.initAD)(i.default),(0,f.initHook)(i.default),(0,p.initInvite)(i.default),(0,y.initEvent)(i.default),e.exports=window.ws=i.default},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},n=(o=a(2))&&o.__esModule?o:{default:o},r={tmp:{},options:{scheme:"https://",host:"api.websdk.cn",apiVersion:"v1",USER_KEY:"ws_user",CONF_KEY:"ws_conf",DATA_KEY:"ws_data",share10:!0,commonDuration:120,allowAld:!1},conf:{},user:{},data:{},version:"1.0.1",mode:"default",debug:!0,shareCallbackData:{},shareTempData:{},shareGiftTempData:{},_initCallbacks:[],_showCallbacks:[],_hideCallbacks:[],_afterHideCallbacks:[],_shareCallbacks:[],_openFromShareCallbacks:[],_openFromCodeCallbacks:[],_onInit:function(){var e=!0,t=!1,a=void 0;try{for(var o,i=this._initCallbacks[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var n=o.value;n&&n()}}catch(e){t=!0,a=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw a}}},_onShow:function(e){if(console.log("onShow:",e,"mode:",this.mode),"default"!==this.mode)this.shareCallbackData&&this.shareCallbackData.callback&&"shareAppMessage"==this.mode&&(this.shareCallbackData.callback(e,Date.now()-this.shareCallbackData.ms),this.shareCallbackData={}),this.mode="default";else{var t=!0,a=!1,o=void 0;try{for(var i,n=this._showCallbacks[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;s&&s(e)}}catch(e){a=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(a)throw o}}if(e.query&&"share"===e.query.type?r._openFromShare("onShow",e.query,e):e.query&&e.query.scene&&"code_"===e.query.scene.substring(0,5)&&r._openFromCode("onShow",e.query.scene,e),this.user&&e.shareTicket&&e.query&&e.query.uid==this.user.id)for(var l in this.shareTempData)l==e.query.share_tid&&r._shareCallback(this.shareTempData[l],e)}},_onHide:function(e){if(console.log("onHide:",e,"mode:",this.mode),"default"===this.mode){var t=!0,a=!1,o=void 0;try{for(var i,n=this._hideCallbacks[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var r=i.value;r&&r(e)}}catch(e){a=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(a)throw o}}var s=!0,l=!1,c=void 0;try{for(var u,d=this._afterHideCallbacks[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var h=u.value;h&&h(e)}}catch(e){l=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw c}}}},_openFromShare:function(e,t,a){var o=!0,i=!1,n=void 0;try{for(var r,s=this._openFromShareCallbacks[Symbol.iterator]();!(o=(r=s.next()).done);o=!0){var l=r.value;l&&l({from:e,query:t,options:a})}}catch(e){i=!0,n=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw n}}},_openFromCode:function(e,t,a){r.get({url:"/share/qrcode",data:{scene:t},success:function(o){var i=!0,n=!1,s=void 0;try{for(var l,c=r._openFromCodeCallbacks[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value;u&&u({from:e,scene:t,options:a,query:o.data})}}catch(e){n=!0,s=e}finally{try{!i&&c.return&&c.return()}finally{if(n)throw s}}}})},_shareCallback:function(e,t){wx.getShareInfo({shareTicket:t.shareTicket,success:function(a){e.onShareTicketSuccess&&e.onShareTicketSuccess(a),r.shareLog(e,"click",t.shareTicket,a,t)}.bind(this),fail:function(a){e.onShareTicketFail&&e.onShareTicketFail(a),r.shareLog(e,"click",t.shareTicket,{},t)}.bind(this)})},onInit:function(e){this._initCallbacks.push(e)},onShow:function(e){this._showCallbacks.push(e)},onHide:function(e){this._hideCallbacks.push(e)},afterHide:function(e){this._afterHideCallbacks.push(e)},openFromShare:function(e){this._openFromShareCallbacks.push(e)},openFromCode:function(e){this._openFromCodeCallbacks.push(e)},init:function(e){this.options=i({},n.default.copy(e,this.options)),this.systemInfo=wx.getSystemInfoSync(),this.launchOptions=wx.getLaunchOptionsSync(),this.user=wx.getStorageSync(this.options.USER_KEY),this.conf=wx.getStorageSync(this.options.CONF_KEY),this.data=wx.getStorageSync(this.options.DATA_KEY),this.log("conf:",this.conf),wx.onShow(this._onShow.bind(this)),wx.onHide(this._onHide.bind(this))},onLogined:function(){var e=this.launchOptions;e.query&&"share"===e.query.type?r._openFromShare("onLaunch",e.query,e):e.query&&e.query.scene&&"code_"===e.query.scene.substring(0,5)&&r._openFromCode("onLaunch",e.query.scene,e),this._onInit()}};t.default=r},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.initUtil=function(e){e.checkSDK=function(e,t){var a=this;return function(o,i){return a.requireSDK(e)?t.apply(a,[o]):(a.log("微信SDK版本过低："+a.systemInfo.SDKVersion+",需要更新至"+e),void(i&&"function"==typeof i&&i([a.systemInfo.SDKVersion,e])))}},e.requireSDK=function(e){return r.compareVersion(this.systemInfo.SDKVersion,e)},e.requireSystemVersion=function(e){return r.compareVersion(this.systemInfo.version,e)},e.isIPhoneX=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("iPhone X")},e.isIOS=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("iOS")},e.isAndroid=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("Android")},e.toFixed=function(e,t){for(var a=e.toFixed(t)+"";"0"===a[a.length-1];)if("."===(a=a.substring(0,a.length-1))[a.length-1]){a=a.substring(0,a.length-1);break}return a},e.log=function(){try{if(this.debug&&console&&console.log){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return console.log.apply(console,t)}}catch(e){}},e.setAlertCallback=function(t){e._alertCallback=t},e.alert=function(t){e._alertCallback?e._alertCallback(t):wx.showModal({content:t})},e.trace=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.post({url:"/log/trace",data:{key:e,pos:t,data:a}})},e.getServerTime=function(){return e.conf&&e.conf.server_time?e.conf.server_time:0}};var i,n=(i=a(3))&&i.__esModule?i:{default:i},r={sign:function(e,t){if("string"==typeof e)return r.signSort(e,t);if("object"==(void 0===e?"undefined":o(e))){var a=[];for(var i in e)a.push(i+"="+e[i]);return r.signSort(a.join("&"),t)}},signSort:function(e,t){var a=e.split("&").sort().join("&")+"&key="+t;return(0,n.default)(a).toUpperCase()},S4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){return Date.now()+"-"+r.S4()},compareVersion:function(e,t){var a=parseFloat(e),o=parseFloat(t),i=e.replace(a+".",""),n=t.replace(o+".","");return a>o||!(a<o)&&i>=n},copy:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||(e&&e.push?[]:{});for(var a in e)t[a]="object"===o(e[a])?r.copy(e[a]):e[a];return t},randomSort:function(e){for(var t,a=0;a<e.length;a++){var o=parseInt(Math.random()*e.length+"");t=e[o],e[o]=e[a],e[a]=t}return e}};t.default=r},function(e,t,a){var o;"function"==typeof Symbol&&Symbol.iterator,function(i){"use strict";function n(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function r(e,t,a,o,i,r){return n((s=n(n(t,e),n(o,r)))<<(l=i)|s>>>32-l,a);var s,l}function s(e,t,a,o,i,n,s){return r(t&a|~t&o,e,t,i,n,s)}function l(e,t,a,o,i,n,s){return r(t&o|a&~o,e,t,i,n,s)}function c(e,t,a,o,i,n,s){return r(t^a^o,e,t,i,n,s)}function u(e,t,a,o,i,n,s){return r(a^(t|~o),e,t,i,n,s)}function d(e,t){var a,o,i,r,d;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var h=1732584193,f=-271733879,p=-1732584194,m=271733878;for(a=0;a<e.length;a+=16)o=h,i=f,r=p,d=m,h=s(h,f,p,m,e[a],7,-680876936),m=s(m,h,f,p,e[a+1],12,-389564586),p=s(p,m,h,f,e[a+2],17,606105819),f=s(f,p,m,h,e[a+3],22,-1044525330),h=s(h,f,p,m,e[a+4],7,-176418897),m=s(m,h,f,p,e[a+5],12,1200080426),p=s(p,m,h,f,e[a+6],17,-1473231341),f=s(f,p,m,h,e[a+7],22,-45705983),h=s(h,f,p,m,e[a+8],7,1770035416),m=s(m,h,f,p,e[a+9],12,-1958414417),p=s(p,m,h,f,e[a+10],17,-42063),f=s(f,p,m,h,e[a+11],22,-1990404162),h=s(h,f,p,m,e[a+12],7,1804603682),m=s(m,h,f,p,e[a+13],12,-40341101),p=s(p,m,h,f,e[a+14],17,-1502002290),h=l(h,f=s(f,p,m,h,e[a+15],22,1236535329),p,m,e[a+1],5,-165796510),m=l(m,h,f,p,e[a+6],9,-1069501632),p=l(p,m,h,f,e[a+11],14,643717713),f=l(f,p,m,h,e[a],20,-373897302),h=l(h,f,p,m,e[a+5],5,-701558691),m=l(m,h,f,p,e[a+10],9,38016083),p=l(p,m,h,f,e[a+15],14,-660478335),f=l(f,p,m,h,e[a+4],20,-405537848),h=l(h,f,p,m,e[a+9],5,568446438),m=l(m,h,f,p,e[a+14],9,-1019803690),p=l(p,m,h,f,e[a+3],14,-187363961),f=l(f,p,m,h,e[a+8],20,1163531501),h=l(h,f,p,m,e[a+13],5,-1444681467),m=l(m,h,f,p,e[a+2],9,-51403784),p=l(p,m,h,f,e[a+7],14,1735328473),h=c(h,f=l(f,p,m,h,e[a+12],20,-1926607734),p,m,e[a+5],4,-378558),m=c(m,h,f,p,e[a+8],11,-2022574463),p=c(p,m,h,f,e[a+11],16,1839030562),f=c(f,p,m,h,e[a+14],23,-35309556),h=c(h,f,p,m,e[a+1],4,-1530992060),m=c(m,h,f,p,e[a+4],11,1272893353),p=c(p,m,h,f,e[a+7],16,-155497632),f=c(f,p,m,h,e[a+10],23,-1094730640),h=c(h,f,p,m,e[a+13],4,681279174),m=c(m,h,f,p,e[a],11,-358537222),p=c(p,m,h,f,e[a+3],16,-722521979),f=c(f,p,m,h,e[a+6],23,76029189),h=c(h,f,p,m,e[a+9],4,-640364487),m=c(m,h,f,p,e[a+12],11,-421815835),p=c(p,m,h,f,e[a+15],16,530742520),h=u(h,f=c(f,p,m,h,e[a+2],23,-995338651),p,m,e[a],6,-198630844),m=u(m,h,f,p,e[a+7],10,1126891415),p=u(p,m,h,f,e[a+14],15,-1416354905),f=u(f,p,m,h,e[a+5],21,-57434055),h=u(h,f,p,m,e[a+12],6,1700485571),m=u(m,h,f,p,e[a+3],10,-1894986606),p=u(p,m,h,f,e[a+10],15,-1051523),f=u(f,p,m,h,e[a+1],21,-2054922799),h=u(h,f,p,m,e[a+8],6,1873313359),m=u(m,h,f,p,e[a+15],10,-30611744),p=u(p,m,h,f,e[a+6],15,-1560198380),f=u(f,p,m,h,e[a+13],21,1309151649),h=u(h,f,p,m,e[a+4],6,-145523070),m=u(m,h,f,p,e[a+11],10,-1120210379),p=u(p,m,h,f,e[a+2],15,718787259),f=u(f,p,m,h,e[a+9],21,-343485551),h=n(h,o),f=n(f,i),p=n(p,r),m=n(m,d);return[h,f,p,m]}function h(e){var t,a="",o=32*e.length;for(t=0;t<o;t+=8)a+=String.fromCharCode(e[t>>5]>>>t%32&255);return a}function f(e){var t,a=[];for(a[(e.length>>2)-1]=void 0,t=0;t<a.length;t+=1)a[t]=0;var o=8*e.length;for(t=0;t<o;t+=8)a[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return a}function p(e){var t,a,o="";for(a=0;a<e.length;a+=1)t=e.charCodeAt(a),o+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return o}function m(e){return unescape(encodeURIComponent(e))}function y(e){return function(e){return h(d(f(e),8*e.length))}(m(e))}function v(e,t){return function(e,t){var a,o,i=f(e),n=[],r=[];for(n[15]=r[15]=void 0,i.length>16&&(i=d(i,8*e.length)),a=0;a<16;a+=1)n[a]=909522486^i[a],r[a]=1549556828^i[a];return o=d(n.concat(f(t)),512+8*t.length),h(d(r.concat(o),640))}(m(e),m(t))}function g(e,t,a){return t?a?v(t,e):p(v(t,e)):a?y(e):p(y(e))}void 0===(o=function(){return g}.call(t,a,t,e))||(e.exports=o)}()},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=e.success,a=e.fail;return"GET"==e.method?e.url=c(e.url,e.data):e.url=c(e.url),e.header||(e.header={}),e.header.Authorization=u.default.isLogined()?u.default.user.token:"",e.success=function(o){"LOGIN_REQUIRED"===o.data.key?(u.default.log("login required:",e.url,e,o),u.default.doLogin()):0===o.data.code?(u.default.log("success:",e.url,e,o),t&&t(o.data)):a?(u.default.log("fail:",e.url,e,o),a(o.data)):u.default.log("unknown:",e.url,e,o)},e.fail=function(t){u.default.log("error:",e.url,e,t),a&&a(t)},wx.request(e)}function n(e){return e.method="GET",i(e)}function r(e){return e.method="POST",i(e)}function s(e){return e.method="PUT",i(e)}function l(e){return e.method="DELETE",i(e)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){-1==e.indexOf("?")&&(e+="?");var a=[];if(u.default.isLogined()&&a.push("user="+u.default.user.id),u.default.launchOptions){var o=u.default.launchOptions.query;o&&(o.uid&&a.push("uid="+o.uid),o.channel&&a.push("channel="+o.channel),o.share_id&&a.push("share_id="+o.share_id),o.share_tid&&a.push("share_tid="+o.share_tid),o.pos&&a.push("share_pos="+o.pos),o.scene&&a.push("scene="+decodeURIComponent(o.scene)))}a.push("v="+u.default.version),a.push("version="+u.default.options.version),a.push("appid="+u.default.options.appid),a.push("t="+Date.now()),"?"!==e.charAt(e.length-1)&&"&"!==e.charAt(e.length-1)&&(e+="&");var i=(e+=a.join("&")).split("?")[1];if(t){var n=[];for(var r in t)n.push(r+"="+t[r]);i+="&"+n.join("&")}if((e+="&sign="+d.default.sign(i,u.default.options.secret)).startsWith("/"))return u.default.options.scheme+u.default.options.host+"/"+u.default.options.apiVersion+e}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.initHTTP=function(e){e.request=i,e.get=n,e.post=r,e.put=s,e.delete=l,e.formatURL=c};var u=o(a(1)),d=o(a(2))},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initUser=function(e){e.isLogined=function(){return e.user&&e.user.token},e.getLoginStatus=function(){return e.isLogined()?"success":e.isCheckSession||e.isLogining?"logining":"fail"},e.login=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?e.doLogin(t):(e.isCheckSession=!0,wx.checkSession({success:function(){e.checkLogin(t),e.isCheckSession=!1}.bind(e),fail:function(){e.doLogin(t),e.isCheckSession=!1}.bind(e)}))},e.checkLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.isLogined()?(e.loginSuccess(),!e.requireSDK("2.0.3")&&e.needUserInfo()&&e.getUserInfo()):e.doLogin(t)},e.checkCode2access=function(t){var a=t.session_key?t:null;e.post({url:"/oauth/code2access_token",data:t,success:function(t){e.isLogining=!1,e.saveUser(t.data),e.checkLogin(a)}.bind(e),fail:e.loginFail.bind(e)})},e.doLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.isLogining||(e.isLogining=!0,e.user=null,t?e.checkCode2access(t):wx.login({success:function(t){t.code?e.checkCode2access({code:t.code}):e.loginFail(t)}.bind(e),fail:e.loginFail.bind(e)}))},e.loginSuccess=function(t){var a=e.conf&&e.conf.last?e.conf.last:0;!a||Date.now()-a>1e3*e.options.commonDuration?e.getCommon(t):(e.doLoginSuccess(t),e.onLogined())},e.getCommon=function(t){e.get({url:"/common",success:function(a){e.conf=a.data.conf,e.conf.last=Date.now(),wx.setStorage({key:e.options.CONF_KEY,data:e.conf}),e.data||(e.data=a.data.data,wx.setStorage({key:e.options.DATA_KEY,data:e.data})),e.doLoginSuccess(t),e.onLogined()}.bind(e),fail:function(t){e.loginFail(t)}.bind(e)})},e.doLoginSuccess=function(t){e.isLogining=!1,e.loginCompleteCallback&&e.loginCompleteCallback(t),e.loginSuccessCallback&&e.loginSuccessCallback(t)},e.loginFail=function(t){e.isLogining=!1,e.loginCompleteCallback&&e.loginCompleteCallback(t),e.loginFailCallback&&e.loginFailCallback(t)},e.onLoginSuccess=function(t){e.loginSuccessCallback=t},e.onLoginFail=function(t){e.loginFailCallback=t},e.onLoginComplete=function(t){e.loginCompleteCallback=t},e.checkUserInfo=function(){e.needUserInfo()&&e.getUserInfo()},e.needUserInfo=function(){return!e.user||!e.user.nickname||!e.user.avatar},e.getUserInfo=function(){wx.getUserInfo({withCredentials:!0,success:function(t){return e.post({url:"/oauth/update_userinfo",data:t,success:function(t){e.saveUser(t.data),e.needUserInfo()?e.getUserInfoFail(t):e.getUserInfoSuccess()}.bind(e),fail:e.getUserInfoFail.bind(e)}),t}.bind(e),fail:e.getUserInfoFail.bind(e)})},e.getUserInfoSuccess=function(e){},e.getUserInfoFail=function(e){},e.saveUser=function(t){e.user=t,e.user.last=Date.parse(new Date),wx.setStorage({key:e.options.USER_KEY,data:e.user})}}},function(e,t,a){"use strict";function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return n.default.conf&&void 0!==n.default.conf[e]?n.default.conf[e]:t}Object.defineProperty(t,"__esModule",{value:!0}),t.initConfig=function(e){e.getConfig=o};var i,n=(i=a(1))&&i.__esModule?i:{default:i}},function(e,t,a){"use strict";function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d.default.data&&void 0!==d.default.data[e]?d.default.data[e]:t}function i(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];d.default.data||(d.default.data={}),d.default.data[e]=t,a&&d.default.postData(e)}function n(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d.default.data=e,t&&d.default.postData()}function r(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=d.default.getData(e,o)+t;return d.default.setData(e,i,a),i}function s(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],wx.setStorage({key:d.default.options.DATA_KEY,data:d.default.data}),d.default.post({url:"/data",data:d.default.data})}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"default",n={};if(e instanceof Object){var r=e;n={id:r.id,score:r.score,time:r.time,version:d.default.options.version,data:r.data,key:r.key}}else n={id:e,score:t,time:a,version:d.default.options.version,data:o,key:i};d.default.post({url:"/score",data:n,success:function(e){d.default.log("提交分数成功：",t,e)},fail:function(e){d.default.log("提交分数失败：",t,e)}})}function c(e){var t=e.key,a=e.scale,o=void 0===a?"week":a,i=e.skip,n=void 0===i?0:i,r=e.limit,s=void 0===r?10:r,l=e.success,c=void 0===l?null:l,u=e.fail,h=void 0===u?null:u;d.default.get({url:"/score",data:{score_key:t,scale:o,skip:n,limit:s},success:function(e){c&&c(e.data)},fail:function(e){h&&h(e)}})}Object.defineProperty(t,"__esModule",{value:!0}),t.initData=function(e){e.getData=o,e.setData=i,e.setAllData=n,e.incData=r,e.postData=s,e.postGameScore=l,e.getScoreRank=c};var u,d=(u=a(1))&&u.__esModule?u:{default:u}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initShare=function(e){e.share=function(t){e.options.allowAld?e.aldShareAppMessage(this.createShareOptions(t)):e.shareAppMessage(this.createShareOptions(t)),this.options.share10&&(this.log("share10"),this.shareLog(t,"share10","",{},{})),t.onShareBack&&(e.shareCallbackData={callback:t.onShareBack,ms:Date.now()})},e.createShareOptions=function(t){t.pos||(t.pos="default");var a=this.getShareInfo(t);t.shareId=a.shareId,t.title||(t.title=a.title),t.imageUrl||(t.imageUrl=a.imageUrl),t.success||(t.success=a.success),t.fail||(t.fail=a.fail),t.onHttpError||(t.onHttpError=a.onHttpError),t.tid||(t.tid=""+Date.now());var o="type=share&pos="+t.pos+"&share_id="+a.shareId+"&share_tid="+t.tid;return this.isLogined()&&(o+="&uid="+this.user.id),t.gift&&(o+="&gift="+t.gift),t.query?"&"==t.query.indexOf(0)?(t.query=o+t.query,e.log("new share query: "+t.query)):(t.query=o+"&"+t.query,e.log("new share query: "+t.query)):t.query=o,e.shareTempData[t.tid]=t,{title:t.title,imageUrl:t.imageUrl,query:t.query,success:this.shareSuccess(t),fail:this.shareFail(t),complete:t.complete}},e.getShareInfo=function(e){var t,a=this.options.share.title,o=this.options.share.imageUrl,i=0;return e.defaultTitle&&(a=e.defaultTitle),this.conf&&this.conf.shares&&(this.conf.shares[e.pos]?t=this.conf.shares[e.pos]:this.conf.shares.default&&(t=this.conf.shares.default),t&&(t.title&&(a=t.title),t.image&&(o=t.image),t.id&&(i=t.id))),{title:a,imageUrl:o,shareId:i,success:function(){wx.showToast({title:"分享成功！",icon:"success"})},fail:function(){wx.showToast({title:"分享失败！",icon:"fail"})},onHttpError:function(){wx.showToast({title:"网络出错！",icon:"fail"})}}},e.shareSuccess=function(t){return function(a){console.log("shareSuccess"),delete e.shareTempData[t.tid];var o=!0;t.onShareSuccess&&(o=t.onShareSuccess(a)),o&&(a.shareTickets&&a.shareTickets.length>0?wx.getShareInfo({shareTicket:a.shareTickets[0],success:function(e){t.onShareTicketSuccess&&t.onShareTicketSuccess(e),this.shareLog(t,"success",a.shareTickets[0],e,a)}.bind(this),fail:function(e){t.onShareTicketFail&&t.onShareTicketFail(e),this.shareLog(t,"success",a.shareTickets[0],{},a)}.bind(this)}):(t.onShareTicketFail&&t.onShareTicketFail(),this.shareLog(t,"success","",{},a)))}.bind(this)},e.shareFail=function(e){return function(t){console.log("shareFail");var a=!0;e.onShareFail&&(a=e.onShareFail(t)),a&&this.shareLog(e,"fail","",{},t)}.bind(this)},e.shareLog=function(t,a,o,i,n){this.post({url:"/log/share",data:{share_id:t.shareId,title:t.title,query:t.query,image:t.imageUrl,pos:t.pos,tid:t.tid,status:a,shareTicket:o,info:i,error:n.errMsg,system_version:e.systemInfo.system,sdk_version:e.systemInfo.SDKVersion},success:function(o){"success"!==a&&"click"!==a||!t.success?"fail"===a&&t.fail&&t.fail(o,n):(t.success(o,n),delete e.shareTempData[t.tid])},fail:function(e){"success"!==a&&"click"!==a||!t.onHttpError?"fail"===a&&t.fail&&t.fail(e,n):t.onHttpError(e,n)}})},e.isEnableShare=function(){return!(!e.conf||!e.conf.allow_share||e.requireSystemVersion("6.7.0"))}}},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e){"string"==typeof e?(c.process=e,c.processDuration=Date.now()-c.initStartAt):s.default.log("setProcess():  参数类型错误")}function n(e){s.default.post({url:"/log/process",data:e,success:function(e){s.default.log("提交游戏进度数据成功：",e)},fail:function(e){s.default.log("提交游戏进度数据失败：",e)}})}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e};t.initProcess=function(e){e.onShow(function(e){u=Date.now(),c.showOptions=JSON.stringify(e)}),e.afterHide(function(t){var a=Date.now(),o=c=r({},c,{times:c.times+1,showDuration:u?a-u:a-c.initStartAt,duration:a-c.initStartAt}),i=(o.hasInited,o.initStartAt,function(e,t){var a={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(a[o]=e[o]);return a}(o,["hasInited","initStartAt"]));c.hasInited?n(i):(c.hasInited=!0,n(r({systemInfo:JSON.stringify(e.systemInfo),launchOptions:JSON.stringify(e.launchOptions)},i)))}),e.setProcess=i};var s=o(a(1)),l=o(a(2)),c={hasInited:!1,initStartAt:Date.now(),showOptions:"",times:0,uuid:l.default.guid(),duration:0,showDuration:0,process:"init",processDuration:0},u=0},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initPayment=function(e){e.getPaymentResult=function(e){var t=e.success,a=void 0===t?null:t,o=e.fail,i=void 0===o?null:o;this.get({url:"/payment/result",success:function(e){this.log("获取充值数据成功",e),a&&a(e.data)}.bind(this),fail:function(e){this.log("获取充值数据失败",e),i&&i(e)}.bind(this)})},e.requestMPPayment=function(t){var a=this,o=t.title,i=void 0===o?"点击充值链接进入充值":o,n=t.pos,r=void 0===n?"default":n,s=t.image,l=void 0===s?null:s,c=t.success,u=void 0===c?null:c,d=t.fail,h=void 0===d?null:d,f=t.complete,p=void 0===f?null:f;this.log("打开客服对话"),e.openCustomerServiceConversation({sessionFrom:r,showMessageCard:!0,sendMessageTitle:i,sendMessagePath:"?type=message",sendMessageImg:l||e.conf.shares.default.image,success:function(e){a.log("打开充值会话成功",e),p&&p(),u&&u()},fail:function(e){a.log("打开充值会话fail",e),p&&p(),h&&h()}})},e.requestMPPayment=e.checkSDK("2.0.3",e.requestMPPayment)}},function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=e.pos,a=e.style,o=void 0===a?null:a,s=e.ms,l=void 0===s?0:s,c=e.force,u=void 0!==c&&c,d=e.forceTimeout,h=void 0===d?600:d,f=e.onResize,p=void 0===f?null:f;if(w.default.conf&&w.default.conf.banners&&w.default.conf.banners[t]){var m=w.default.conf.banners[t];if(m.enable){var y=void 0,v=P[t];v&&(y=_[v.adUnitId])&&(v.showed&&n(v),(u||Date.now()-y.created>1e3*h)&&function(e){var t=_[e.adUnitId];if(t)t.hide(),t.destroy(),delete _[e.adUnitId]}(v)),l||(l=w.default.getConfig("banner_ms",120)),v||(v={adUnitId:m.adUnitId,pos:t,count:0,ms:l,duration:0,style:o,width:m.width?m.width>1?1:m.width:1,window:"*",data:[],onResize:p,created:Date.now()},P[t]=v),v.count+=1,v.status="success",(y=_[v.adUnitId])||(y=_[v.adUnitId]=function(e){var t=e.banner,a=e.style,o=void 0===a?null:a,i=w.default.systemInfo.screenWidth*t.width,n=(w.default.systemInfo.screenHeight,wx.createBannerAd({adUnitId:t.adUnitId,style:L({left:0,top:0,width:i,height:180*i/750},o)}));return n.created=Date.now(),n.onError(function(e){t.status="error",t.error=e,t.timeout&&clearTimeout(t.timeout),t.timeout=null,t.showed=null,r(t,"error"),w.default.log("banner 创建失败",t),P[t.pos]&&delete P[t.pos]}),n.onResize(function(e){t.onResize&&t.onResize(e,n)}),n.onLoad(function(e){w.default.log("banner 加载完成",t),n.created=Date.now()}),n}({banner:v,style:o})),v.showed=Date.now(),setTimeout(function(){y.show()},.01),v.ms&&y&&(v.timeout&&clearTimeout(v.timeout),v.timeout=setTimeout(function(){i({pos:t,style:o,ms:l,force:!0,onResize:p})},1e3*l))}}else w.default.log("createBanner 没有配置: "+t)}function n(e){var t=P[e];if(t&&t.showed){var a=_[t.adUnitId];if(a){var o=a.style,i=o.realWidth,n=o.realHeight,r=Date.now()-t.showed;return a.hide(),t.duration+=r,t.data.push({created:a.created,showed:t.showed,duration:r}),t.timeout&&clearTimeout(t.timeout),t.timeout=null,t.showed=null,t.window=i+"*"+Math.round(n),!0}}return!1}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"onHide",a={adUnitId:e.adUnitId,pos:e.pos,ms:e.ms,count:e.count,duration:e.duration,data:JSON.stringify(e.data),window:e.window,status:e.status,error:e.error,commit:t};e.count=0,e.duration=0,e.status="success",e.error="",e.data=[],w.default.log("postBannerData",a),w.default.post({url:"/log/ad/banner",data:a,success:function(e){w.default.log("提交banner数据成功：",e)},fail:function(e){w.default.log("提交banner数据失败：",e)}})}function s(e){return w.default.conf&&w.default.conf.videos&&w.default.conf.videos[e]?!!w.default.conf.videos[e].enable:(w.default.log("createVideo 没有配置: "+e),!1)}function l(e){function t(e){p.status="error",p.error=e,c(p),f&&f(e),d&&d(e),i()}function a(e){p.created=Date.now()}function o(e){f&&f(e),p.duration=Date.now()-p.created,e&&e.isEnded||void 0===e?l&&l({isEnded:!0,duration:p.duration}):(p.status="cancel",l&&l({isEnded:!1,duration:p.duration})),c(p),i()}function i(){m.offError(t),m.offLoad(a),m.offClose(o)}var n=e.pos,r=e.success,l=void 0===r?null:r,u=e.fail,d=void 0===u?null:u,h=e.complete,f=void 0===h?null:h;if(!s(n))return!1;var p={adUnitId:w.default.conf.videos[n].adUnitId,pos:n,status:"success",created:Date.now(),duration:0},m=wx.createRewardedVideoAd({adUnitId:p.adUnitId});return m.onError(t),m.onLoad(a),m.onClose(o),m.show().catch(function(e){console.log("ws.createVideo error:",e),m.load().then(function(){return m.show()})}),!0}function c(e){w.default.post({url:"/log/ad/rewardedvideo",data:e,success:function(e){w.default.log("提交激励视频数据成功：",e)},fail:function(e){w.default.log("提交激励视频数据失败：",e)}})}function u(e){var t;if(w.default.conf&&w.default.conf.games&&(w.default.conf.games[e]?t=w.default.conf.games[e]:w.default.conf.games.default&&(t=w.default.conf.games.default),t&&t.length>0)){w.default.tmp.getMoreGame||(w.default.tmp.getMoreGame={});var a=w.default.tmp.getMoreGame[e];return(!a||a>=t.length)&&(a=0),w.default.tmp.getMoreGame[e]=a+1,t[a]}}function d(e){var t;if(w.default.conf&&w.default.conf.games)if(w.default.conf.games[e]?t=w.default.conf.games[e]:w.default.conf.games.default&&(t=w.default.conf.games.default),t&&t.length>0){for(var a=[],o=0;o<t.length;o++)a.push(t[o].image);w.default.previewImage({urls:b.default.randomSort(a)})}else wx.showToast({title:"没有更多游戏！",icon:"info"});else wx.showToast({title:"没有更多游戏！",icon:"info"})}function h(e){return B&&B[e]?(B[e].showed&&y(e),B[e]):null}function f(e){for(var t in e)B[t]={pos:t,data:e[t],last:Date.now(),duration:D,total_ms:0,logs:[],showed:!0}}function p(e){var t=e.pos,a=void 0===t?"default":t,o=e.count,i=void 0===o?1:o,n=e.success,r=void 0===n?null:n,s=e.fail,l=void 0===s?null:s,c=h(a);c?(c.total_ms>=D&&S({ad:c}),B[a].showed=!0,B[a].last=Date.now(),r&&r({code:0,data:c.data,key:"SUCCESS"})):w.default.get({url:"/game/ad",data:{pos:a,count:i},success:function(e){if(0==e.code){if(!Array.isArray(e.data)||Array.isArray(e.data)&&0!=e.data.length){var t={};t[a]=e.data,f(t)}r&&r(e)}else l&&l(e)},fail:function(e){l&&l(e)}})}function m(e){var t=e.data,a=void 0===t?[{pos:"default",count:1}]:t,o=e.success,i=void 0===o?null:o,n=e.fail,r=void 0===n?null:n,s={},l=!1,c=!0,u=!1,d=void 0;try{for(var p,m=a[Symbol.iterator]();!(c=(p=m.next()).done);c=!0){var y=p.value,v=h(y.pos);v?v.total_ms>=D&&(s[y.pos]=v):l=!0}}catch(e){u=!0,d=e}finally{try{!c&&m.return&&m.return()}finally{if(u)throw d}}if(s&&S({ads:s}),l)w.default.post({url:"/game/ad",data:{pos:a},success:function(e){0==e.code?(e.data&&f(e.data),i&&i(e)):r&&r(e)},fail:function(e){r&&r(e)}});else{var g={},L=!0,b=!1,P=void 0;try{for(var _,C=a[Symbol.iterator]();!(L=(_=C.next()).done);L=!0){var M=_.value;B[M.pos].showed=!0,B[M.pos].last=Date.now(),g[M.pos]=B[M.pos].data}}catch(e){b=!0,P=e}finally{try{!L&&C.return&&C.return()}finally{if(b)throw P}}i&&i({code:0,data:g,key:"SUCCESS"})}}function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";!function(){function e(e){var t=Date.now(),a=t-e.last;e.logs.push({ms:a,last:e.last,posted:!1}),e.total_ms+=a,e.last=t}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!t||B[t])if(t)e(B[t]);else for(var a in B)e(B[a])}(e),B[e]&&(B[e].showed=!1)}function v(e){function t(e){e.image?w.default.previewImage({urls:[e.image],success:function(e){w.default.log("tapGameAD, success"),l&&l(e)},fail:function(e){w.default.log("tapGameAD, fail"),u&&u(e)},complete:function(e){w.default.log("tapGameAD, complete"),h&&h(e)}}):w.default.log("tapGameAD，ad参数内image属性缺失")}function a(e){w.default.requireSDK("2.2.0")?e.appid?wx.navigateToMiniProgram({appId:e.appid,path:e.path,success:function(e){w.default.log("tapGameAD, success"),l&&l(e)},fail:function(e){w.default.log("tapGameAD, fail"),u&&u(e)},complete:function(e){w.default.log("tapGameAD, complete"),h&&h(e)}}):w.default.log("tapGameAD, ad参数内appid属性缺失"):e.image?t(e):w.default.alert("当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。")}var o=e.pos,i=e.ad,n=e.redirect,r=void 0!==n&&n,s=e.success,l=void 0===s?null:s,c=e.fail,u=void 0===c?null:c,d=e.complete,h=void 0===d?null:d,f=i;B&&B[o]&&f?(function(e,t){if(!t||!t.cid||!t.id)return!1;g([{pos:e,tid:t.tid,commit:"click",data:[{cid:t.cid,id:t.id,action:t.action}]}])}(o,f),"code"==f.action?t(f):"navigate"==f.action?a(f):r?a(f):t(f)):w.default.log("tapGameAD pos无效，没有对应数据，或未传ad参数")}function g(e){w.default.post({url:"/game/ad/log",data:e,success:function(t){for(var a=0;a<e.length;a++){var o=e[a];if("show"==o.commit&&o.pos in B)for(var i=0;i<B[o.pos].logs.length;i++)B[o.pos].logs[i].posted=!0}w.default.log("广告数据提交成功！")},fail:function(e){w.default.log("广告数据提交失败！")}})}function S(e){function t(e){for(var t=[],a=0;a<e.logs.length;a++)if(!e.logs[a].posted){for(var o={pos:e.pos,tid:e.data[0].tid,commit:"show",last:e.logs[a].last,ms:e.logs[a].ms,data:[]},i=0;i<e.data.length;i++)o.data.push({id:e.data[i].id,cid:e.data[i].cid,action:e.data[i].action});t.push(o)}return t}var a=e.ads,o=void 0===a?null:a,i=e.ad,n=void 0===i?null:i;if(!o&&!n)return!1;var r=[];if(o)for(var s in o)r=r.concat(t(o[s]));else n&&(r=t(n));r.length>0&&g(r)}Object.defineProperty(t,"__esModule",{value:!0});var L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e};t.initAD=function(e){e.onShow(function(){for(var t in P){var a=P[t];a.isShow&&(e.createBanner({pos:a.pos,style:a.style,ms:a.ms,onResize:a.onResize}),a.isShow=!1)}for(var o=0;o<C.length;o++){var i=C[o];B[i].showed=!0,B[i].last=Date.now()}C=[]}),e.afterHide(function(){for(var e in P){var t=P[e];t.isShow=t.showed,t.isShow&&n(t.pos),t.duration>0&&r(t)}for(var a in B)B[a].showed&&(y(a),C.push(a));S({ads:B})}),e.createBanner=e.checkSDK("2.0.4",i),e.closeBanner=e.checkSDK("2.0.4",n),e.createVideo=e.checkSDK("2.0.4",l),e.isEnableVideo=s,e.getMoreGame=u,e.showMoreGame=d,e.getGameAd=p,e.hideGameAd=y,e.tapGameAd=v,e.fetchGameAd=m};var w=o(a(1)),b=o(a(2)),P={},_={},B={},C=[],D=12e4},function(e,t,a){"use strict";function o(e,t){e[t]=function(){var a;return e.mode=t,"aldShareAppMessage"==t&&(e.mode="shareAppMessage"),(a=wx)[t].apply(a,arguments)}}Object.defineProperty(t,"__esModule",{value:!0}),t.initHook=function(e){e.setMode=function(t){e.mode=t},o(e,"previewImage"),o(e,"openCustomerServiceConversation"),o(e,"shareAppMessage"),o(e,"aldShareAppMessage")};var i;(i=a(1))&&i.__esModule},function(e,t,a){"use strict";function o(e,t){var a={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(a[o]=e[o]);return a}function i(e){var t=e.pos,a=void 0===t?null:t,o=e.success,i=void 0===o?null:o,n=e.fail,r=void 0===n?null:n,s={};a&&(s.pos=a),g.default.get({url:"/invited/users/count",data:s,success:function(e){i&&i(e.data.count)},fail:function(e){r&&r(e)}})}function n(e){var t=e.pos,a=void 0===t?null:t,o=e.receive,i=void 0===o||o,n=e.skip,r=void 0===n?0:n,s=e.limit,l=void 0===s?-1:s,c=e.success,u=void 0===c?null:c,d=e.fail,h=void 0===d?null:d,f={skip:r,limit:l,receive:i};a&&(f.pos=a),g.default.get({url:"/invited/users",data:f,success:function(e){u&&u(e.data)},fail:function(e){h&&h(e)}})}function r(e){var t=e.user,a=e.pos,o=void 0===a?null:a,i=e.success,n=void 0===i?null:i,r=e.fail,s=void 0===r?null:r,l={users:[{id:t.id,gift:t.gift}]};o&&(l.pos=o),g.default.post({url:"/invited/gift/receive",data:l,success:function(e){n&&n(e.data.receive[0])},fail:function(e){s&&s(e)}})}function s(e){var t=e.users,a=e.pos,o=void 0===a?null:a,i=e.success,n=void 0===i?null:i,r=e.fail,s=void 0===r?null:r,l={users:[]},c=!0,u=!1,d=void 0;try{for(var h,f=t[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value;l.users.push({id:p.id,gift:p.gift})}}catch(e){u=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}o&&(l.pos=o),g.default.post({url:"/invited/gift/receive",data:l,success:function(e){n&&n(e.data.receive)},fail:function(e){s&&s(e)}})}function l(e,t){if(t&&t.gift){var a={type:e,gift:t.gift,uid:t.uid,share_tid:t.share_tid},o=g.default.conf[t.gift];o&&(a.receive=!0),g.default.post({url:"/share/gift/log",data:a,success:function(e){if(o){var i=e.data;i.is_self&&o.not_allow_self?g.default.alert(o.not_allow_self_tip||"不能领取自己送出的礼物～"):i.user_count>=(o.date_limit||2)?g.default.alert(o.date_limit_tip||"今天已经领取太多次了～"):i.user_share_count>=(o.share_date_limit||1)?g.default.alert(o.share_date_limit_tip||"已经领取过该礼物了～"):i.count>=(o.limit||10)?g.default.alert(o.limit_tip||"该礼物被领光了～"):(e={gift:t.gift,query:t,conf:o,options:a,data:i},g.default._onGiftCallback&&g.default._onGiftCallback(e))}}})}}function c(e){e.from;var t=e.query;e.options,l("share",t)}function u(e){e.from,e.scene,e.options,l("code",e.query)}function d(e){g.default._onGiftCallback=e}function h(e){var t=e.gifts,a=e.users,o=void 0===a||a,i=e.receive,n=void 0===i||i,r=e.dateLimit,s=void 0===r?0:r,l=e.cache,c=void 0===l?60:l,u=e.limit,d=void 0===u?0:u,h=e.success,f=void 0===h?null:h,p=e.fail,m=void 0===p?null:p;if("boolean"==typeof o&&"boolean"==typeof n&&"number"==typeof s&&"number"==typeof c&&"number"==typeof d){var y=!0,v=[t.sort().toString(),o,n,s,d].join("-");g.default.shareGiftTempData&&g.default.shareGiftTempData[v]&&Date.now()-g.default.shareGiftTempData[v].ms<1e3*c&&(y=!1),y?g.default.post({url:"/share/gift/receive",data:{gifts:t,is_users:o,receive:n,date_limit:s,limit:d},success:function(e){g.default.shareGiftTempData[v]={data:e.data,ms:Date.now()},f&&f(e.data)},fail:m}):f&&f(g.default.shareGiftTempData[v].data)}else g.default.log("requestShareGift, 参数格式异常")}function f(e){var t=e.users,a=e.success,o=void 0===a?null:a,i=e.fail,n=void 0===i?null:i;Array.isArray(t)?g.default.post({url:"/share/gift/receive2",data:{users:t},success:function(e){o&&o(e)},fail:function(e){n&&n(e)}}):g.default.log("receiveShareGift, users参数格式错误")}function p(e){var t=e.pos,a=e.bg,i=void 0===a||a,n=e.success,r=void 0===n?null:n,s=e.fail,l=void 0===s?null:s,c=o(e,["pos","bg","success","fail"]);g.default.post({url:"/share/qrcode",data:y({pos:t,bg:i,uid:g.default.user.id,share_tid:Date.now()+""},c),success:function(e){r&&r(e.data)},fail:l})}function m(e){var t=e.pos,a=e.bg,i=void 0===a||a,n=e.filePath,r=void 0===n?"":n,s=e.success,l=void 0===s?null:s,c=e.fail,u=void 0===c?null:c,d=e.complete,h=void 0===d?null:d,f=o(e,["pos","bg","filePath","success","fail","complete"]);p(y({pos:t,bg:i,success:function(e){!function(t){var a=e.codeUrl;wx.downloadFile({url:a,filePath:r,success:function(e){200==e.statusCode&&(g.default.alert("download success",e.tempFilePath),g.default.log("download success",e.tempFilePath),r||(r=e.tempFilePath,wx.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(e){l&&l(e)},fail:function(e){u&&u(e)},complete:function(e){h&&h(e)}})))},fail:function(e){u&&u(e)},complete:function(e){h&&h(e)}})}()},fail:u},f))}Object.defineProperty(t,"__esModule",{value:!0});var y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e};t.initInvite=function(e){e.getInviteCount=i,e.getInviteUsers=n,e.receiveInviteGift=r,e.receiveInviteGifts=s,e.openFromShare(c),e.openFromCode(u),e.onShareGift=d,e.requestShareGift=h,e.receiveShareGift=f,e.getWXACode=p,e.saveWXACode=m};var v,g=(v=a(1))&&v.__esModule?v:{default:v}},function(e,t,a){"use strict";function o(e,t){r.index+=1,r.events.push({event:e,data:t?JSON.stringify(t):null,tm:Date.now()})}Object.defineProperty(t,"__esModule",{value:!0}),t.initEvent=function(e){e.afterHide(function(){n.default.post({url:"/log/event",data:r,success:function(e){0==e.code&&(r.events=[]),n.default.log("事件日志提交成功！")},fail:function(e){n.default.log("事件日志提交失败！")}})}),e.traceEvent=o};var i,n=(i=a(1))&&i.__esModule?i:{default:i},r={index:0,events:[]}}])},{}],17:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=window.wx},{}],18:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=Laya.View,i=Laya.ClassUtils.regClass;!function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("dialog/ReviveView")},t}(o);e.ReviveViewUI=t,i("ui.dialog.ReviveViewUI",t)}(e.dialog||(e.dialog={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("game/GameScene")},t}(o);e.GameSceneUI=t,i("ui.game.GameSceneUI",t)}(e.game||(e.game={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("home/HomeView")},t}(o);e.HomeViewUI=t,i("ui.home.HomeViewUI",t)}(e.home||(e.home={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("over/OverView")},t}(o);e.OverViewUI=t,i("ui.over.OverViewUI",t)}(e.over||(e.over={}))}(a.ui||(a.ui={}))},{}]},{},[2]);